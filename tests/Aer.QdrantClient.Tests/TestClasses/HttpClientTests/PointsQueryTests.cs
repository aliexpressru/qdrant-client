using Aer.QdrantClient.Http;
using Aer.QdrantClient.Http.Filters.Builders;
using Aer.QdrantClient.Http.Formulas.Builders;
using Aer.QdrantClient.Http.Models.Primitives;
using Aer.QdrantClient.Http.Models.Requests.Public;
using Aer.QdrantClient.Http.Models.Requests.Public.QueryPoints;
using Aer.QdrantClient.Http.Models.Requests.Public.Shared;
using Aer.QdrantClient.Http.Models.Shared;
using Aer.QdrantClient.Tests.Base;
using Aer.QdrantClient.Tests.Model;

namespace Aer.QdrantClient.Tests.TestClasses.HttpClientTests;

public class PointsQueryTests : QdrantTestsBase
{
    private QdrantHttpClient _qdrantHttpClient;

    [OneTimeSetUp]
    public void Setup()
    {
        Initialize();

        _qdrantHttpClient = ServiceProvider.GetRequiredService<QdrantHttpClient>();
    }

    [SetUp]
    public async Task BeforeEachTest()
    {
        await ResetStorage();
    }

    [Test]
    public async Task PrefetchWithoutQuery()
    {
        await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName);

        var nearestPointsResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(query: null)
            {
                Prefetch =
                [
                    new PrefetchPoints()
                    {
                        Filter = Q<TestPayload>.BeInRange(
                            p => p.Integer,
                            greaterThanOrEqual: 0,
                            lessThanOrEqual: 2)
                    }
                ],
                WithPayload = true,
                WithVector = true,
                Limit = 10
            },
            CancellationToken.None);

        nearestPointsResponse.Status.IsSuccess.Should().BeFalse();
        nearestPointsResponse.Status.GetErrorMessage().Should().Contain(
            "A query is needed to merge the prefetches. Can't have prefetches without defining a query.");
    }

    [Test]
    public async Task FindNearestPoints()
    {
        var (_, upsertPointsByPointIds, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName);

        var nearestPointsByPointIdResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(upsertPointsByPointIds.First().Value.Id))
            {
                WithPayload = true,
                WithVector = true,
                Limit = 2
            },
            CancellationToken.None);

        var nearestPointsByVectorResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(upsertPointsByPointIds.First().Value.Vector)
            {
                WithPayload = true,
                WithVector = true,
                Limit = 2
            },
            CancellationToken.None);

        nearestPointsByPointIdResponse.Status.IsSuccess.Should().BeTrue();
        nearestPointsByPointIdResponse.Result.Points.Length.Should().Be(2);
        nearestPointsByPointIdResponse.Result.Points.Should().AllSatisfy(
            p => p.Score.Should().BeGreaterThan(0)
        );

        nearestPointsByVectorResponse.Status.IsSuccess.Should().BeTrue();
        nearestPointsByVectorResponse.Result.Points.Length.Should().Be(2);
        nearestPointsByVectorResponse.Result.Points.Should().AllSatisfy(
            p => p.Score.Should().BeGreaterThan(0)
        );

        if (!IsCiEnvironment)
        {
            // CI environment container does not have usage statistics enabled

            nearestPointsByVectorResponse.Usage.Cpu.Should().BeGreaterThan(0);
            nearestPointsByVectorResponse.Usage.PayloadIoRead.Should().BeGreaterThan(0);
            nearestPointsByVectorResponse.Usage.VectorIoRead.Should().BeGreaterThan(0);
        }
        else
        {
            nearestPointsByVectorResponse.Usage.Should().BeNull();
        }
    }

    [Test]
    public async Task FindNearestPoints_Paginated()
    {
        var (_, upsertPointsByPointIds, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName);

        var nearestPointsAllPagesResponse = (
                await _qdrantHttpClient.QueryPoints(
                    TestCollectionName,
                    new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(upsertPointsByPointIds.First().Value.Vector))
                    {
                        WithPayload = false,
                        WithVector = false,
                        Limit = 4
                    },
                    CancellationToken.None
                )
            ).EnsureSuccess();

        var nearestPointsFirstPageResponse = (
                await _qdrantHttpClient.QueryPoints(
                    TestCollectionName,
                    new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(upsertPointsByPointIds.First().Value.Vector))
                    {
                        WithPayload = false,
                        WithVector = false,
                        Limit = 2
                    },
                    CancellationToken.None
                )
            ).EnsureSuccess();

        var nearestPointsSecondPageResponse = (
                await _qdrantHttpClient.QueryPoints(
                    TestCollectionName,
                    new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(upsertPointsByPointIds.First().Value.Vector))
                    {
                        WithPayload = false,
                        WithVector = false,
                        Limit = 2,
                        Offset = 2
                    },
                    CancellationToken.None
                )
            ).EnsureSuccess();

        var allPagesPointIds = nearestPointsAllPagesResponse.Points
            .Select(p => p.Id)
            .ToList();

        var firstPagePointIds = nearestPointsFirstPageResponse.Points
            .Select(p => p.Id)
            .ToList();

        var secondPagePointIds = nearestPointsSecondPageResponse.Points
            .Select(p => p.Id)
            .ToList();

        allPagesPointIds.Should().ContainInOrder(firstPagePointIds.Concat(secondPagePointIds));

        nearestPointsAllPagesResponse.Points.Select(p => p.Score).Should().BeInDescendingOrder();
        nearestPointsFirstPageResponse.Points.Select(p => p.Score).Should().BeInDescendingOrder();
        nearestPointsSecondPageResponse.Points.Select(p => p.Score).Should().BeInDescendingOrder();

    }

    [Test]
    public async Task FindNearestPoints_Paginated_SameVectors()
    {
        // NOTE: this is a real world scenario

        List<UpsertPointsRequest.UpsertPoint> upsertPoints = [
            new(id: PointId.Integer(0), payload: """{"surrogate_key":"0_1005006785873133"}""", vector: new float[]{0.020405341f,0.017473495f,0.015288523f,0.020766625f,-0.03160468f,-0.0050375974f,-0.092570454f,0.015455393f,0.019965833f,0.023316715f,-0.009299858f,-0.07478568f,0.020089962f,-0.05211379f,-0.02820705f,-0.014716663f,0.06486193f,0.04555623f,-0.046913825f,-0.018562399f,0.024961114f,0.04049972f,0.006541753f,0.0584315f,-0.024745619f,0.017168196f,0.0056575933f,-0.005217038f,0.03361516f,-0.0014652753f,0.009217466f,0.0032530394f,0.0358283f,-0.011133635f,-0.026409324f,0.0108804405f,-0.011223681f,-0.020556144f,-0.015635822f,-0.03783375f,0.019039648f,0.031234583f,0.0065751635f,-0.030576678f,0.061908666f,-0.030515395f,-0.022680834f,-0.01050284f,-0.043702386f,-0.022577604f,0.078421265f,-0.03211318f,-0.018026536f,-0.013031033f,0.030150495f,0.015817272f,0.036051814f,-0.050490715f,-0.009040683f,-0.028109811f,-0.051850256f,-0.066624515f,-0.0017948593f,0.06866448f,-0.0047138217f,0.007908565f,-0.03609113f,0.019844666f,-0.11900339f,-0.050442062f,0.011171674f,0.0114651965f,-0.0030644578f,0.0027420952f,0.03814227f,0.019929266f,-0.077108026f,0.02703724f,0.0699403f,-0.052956752f,-0.0027712972f,0.02334194f,0.09380621f,-0.01833146f,-0.03031471f,-0.014148797f,0.110094815f,-0.014369929f,0.05641263f,0.019197501f,0.048034936f,-0.0019444765f,-0.10366259f,0.040997896f,0.038053602f,-0.01859364f,-0.021855073f,0.06505755f,0.032819074f,0.06501625f,-0.031753037f,0.011809836f,0.055423655f,0.03303395f,0.00022308015f,-0.07395063f,-0.061350234f,-0.028685348f,-0.034162894f,0.042512417f,-0.006130883f,-0.034326896f,0.05211278f,0.041530617f,0.054639462f,0.059902865f,0.0028409949f,-0.03244017f,-0.011632244f,0.012405943f,-0.019125085f,-0.013742684f,-0.014497857f,-0.118759945f,0.048139762f,-0.022676757f,-0.058353197f,0.00066321465f,-0.0016319805f,0.012459132f,0.05055237f,0.033863503f,0.005916026f,-0.025141468f,-0.005892578f,0.010146228f,0.007789464f,0.02019931f,-0.05336171f,0.023523547f,-0.019697975f,-0.0017352173f,0.066344075f,0.05008799f,0.05208965f,-0.062003806f,-0.0576898f,0.019098472f,0.00020995122f,0.03469296f,-0.036763668f,-0.014265689f,0.030233702f,-0.008162845f,-0.0013143918f,0.012546278f,0.03599306f,0.031863336f,0.017186502f,0.053613827f,-0.04431063f,-0.002920789f,-0.00049006654f,0.04448926f,0.0012456932f,-0.024353985f,-0.049902122f,-0.015038831f,0.034170736f,-0.031314515f,-0.0053982963f,0.029685136f,-0.012310685f,-0.030021865f,0.009251036f,-0.035655778f,-0.060120396f,0.033847492f,0.11872178f,-0.017215058f,0.038443234f,0.028654693f,-0.009479562f,-0.060859255f,-0.01340962f,-0.042796213f,-0.025405025f,-0.023637692f,0.016585594f,0.030335052f,0.015861155f,0.07744807f,-0.085417174f,0.062467817f,-0.05109676f,-0.016383367f,-0.037843175f,-0.023235247f,-0.03317943f,0.009870667f,0.012738626f,-0.037374437f,0.01820595f,0.04633069f,-0.02345451f,-0.029266976f,0.02489477f,0.00519568f,-0.05978982f,0.0010391296f,-0.0040110685f,0.0057137683f,-0.01762561f,-0.019685369f,-0.05102938f,0.01189866f,-0.038722213f,0.01332644f,0.049621787f,-0.022898564f,0.056190357f,0.009879879f,0.029974105f,0.034286544f,-0.037142586f,-0.06085021f,0.019322474f,0.034474503f,0.042901073f,-0.076595634f,-0.021822475f,-0.049360804f,0.009894827f,-0.011225132f,-0.081553526f,0.05010172f,0.009212422f,0.04284468f,-0.002898161f,-0.00545732f,0.009200215f,-0.0638691f,0.11896856f,0.04173326f,-0.014894632f,0.053928502f,0.013250479f,0.019977426f,-0.019133335f,0.12997995f,-0.06061044f,-0.04062068f,-0.11386002f,0.0044748383f,-0.028455187f,-0.057235774f,-0.015119962f,-0.06425735f,-0.029151514f,0.027122635f,0.037927635f,0.01043599f,-0.037015885f,0.02772116f,-0.019852778f,-0.029604567f,-0.0011564746f,-0.015500381f,-0.03252552f,-0.038543317f,0.06565678f,-0.007886011f,0.035564706f,-0.064065054f,0.03431153f,0.035991084f,-0.041390978f,-0.004770319f,0.015903624f,0.03688401f,-0.06165035f,-0.019922545f,-0.0010114998f,0.009624039f,0.09131475f,-0.0016588324f,0.0030048261f,-0.024199264f,-0.04147212f,0.029206151f,-0.0028295578f,0.07511092f,-0.005836262f,0.039875437f,0.021237293f,0.07695302f,-0.007127115f,0.0034549213f,0.056949846f,-0.06369519f,-0.04681469f,-0.034363903f,0.025263608f,-0.012767724f,-0.024548648f,0.027496729f,-0.09147404f,-0.007021085f,0.076467164f,-0.046481706f,0.16121f,-0.0025667665f,-0.023196533f,0.050723f,0.024760548f,-0.0056684236f,-0.004193695f,-0.013284059f,-0.0017562218f,0.024516642f,-0.04653895f,-0.0035389883f,-0.011193543f,0.001058144f,-0.110969216f,0.027860278f,-0.014295756f,-0.05820839f,0.0022938026f,0.020168161f,0.019360848f,-0.014223347f,-0.012654013f,-0.061162494f,-0.0551971f,-0.027007189f,-0.053944986f,-0.0021168897f,-0.021653889f,0.013175999f,0.06638521f,0.03796358f,0.03595418f,-0.0044210125f,0.03274057f,-0.051812537f,-0.0063962215f,0.011827333f,-0.011512992f,0.01596958f,-0.009227885f,0.056751214f,0.01925197f,0.03272147f,-0.038809888f,-0.040295694f,-0.022727434f,-0.07488111f,0.02700054f,0.052949633f,0.0045738965f,0.061731104f,-0.042744488f,-0.046640843f,0.0024256727f,-0.03988492f,-0.054585416f,0.007667296f,-0.024158342f,-0.06148278f,0.038101904f,-0.055521548f,0.0032435153f,0.06605556f,-0.023967713f,-0.026572155f,0.036948275f,-0.06641852f,0.028074263f,-0.06682596f,-0.046500556f,0.03228171f,0.09336122f,0.04346206f,-0.015952727f,0.010725121f,-0.033057082f,0.035508018f,0.04066268f,-0.009513844f,0.015986817f,0.0893369f,0.049320962f,0.043903004f,0.005745752f,0.036260944f,0.025543759f,0.005456905f,0.013411561f,0.006994667f,0.029233925f,-0.01673675f,0.0044013876f,0.0010172433f,-0.054718774f,0.006592224f,-0.044614654f,-0.00755969f,0.0045578275f,-0.013522714f,0.0032037043f,0.02863725f,-0.001905068f,-0.022409119f,-0.06844833f,-0.033158414f,0.105875894f,-0.01818015f,0.06502136f,-0.017595956f,-0.050276387f,0.073178776f,-0.03318384f,0.037246615f,0.06740131f,-0.0959101f,-0.015371733f,-0.019043433f,0.014109533f,0.016417246f,0.0042725787f,-0.0022966894f,-0.02179996f,0.017517764f,-0.01611183f,0.031125711f,0.10270918f,-0.029456599f,0.08160175f,-0.0018272697f,-0.009985951f,-0.004272777f,0.026855966f,-0.039863843f,0.03871678f,0.06476426f,0.04038347f,0.01197585f,-0.009725162f,-0.035517722f,-0.08025938f,-0.07213066f,0.00034849124f,-0.02776907f,0.06345883f,0.02626048f,-0.037065893f,0.043637034f,-0.022176178f,-0.067606844f,0.071059f,-0.058016445f,-0.04734689f,-0.08135199f,0.034198873f,-0.004335717f,-0.008776495f,-0.0074655274f,-0.023018513f,0.0348475f,0.035703294f,0.05446896f,0.0309721f,-0.01224061f,-0.034645017f,0.011505466f,0.028330352f,-0.01682279f,-0.0010060619f,0.032623388f,-0.018137297f,-0.027202865f,0.03797418f,-0.021596238f,-0.001822538f,0.019897051f,-0.03758493f,-0.056090847f,-0.044790253f,-0.0047697346f,-0.12819369f,0.006631492f,-0.038700674f,0.0569064f,-0.019314863f,0.016492298f,0.027290376f,0.03212807f,0.080711454f,0.041036412f,-0.013603601f,-0.00079715386f,0.021733128f,-0.053466078f,0.014478407f,-0.06721785f,0.011678258f,-0.024698142f,-0.019933911f,0.04266816f,0.0063525965f,-0.049028166f,-0.0024024383f,-0.0101748f,0.0878434f,0.0073020984f,-0.014576856f,-0.0052740206f,0.07432463f,-0.033550292f,0.026111955f,0.0102271205f,0.036016036f,-0.011044918f,-0.01144282f,-0.022363389f,-0.0045188507f,-0.0354879f,-0.020310532f,-0.0029580563f,-0.052803215f,0.006226815f,0.057682265f,0.0107318135f,-0.012024499f,-0.015258439f,0.012475255f,0.041664787f,-0.034203537f,0.01821923f,-0.039384805f,0.021369644f,0.038516138f,0.0682345f,0.011355923f,0.025632376f,0.056417953f,-0.0029713754f,0.004108521f,0.057740785f,-0.048641756f,0.00472134f,0.012980385f,-0.12358879f,-0.02909487f,0.014087389f,0.05527318f,0.05903138f,-0.09022253f,-0.01179272f,-0.05673182f,0.0675277f,-0.024692442f,0.06118439f,-0.0040305564f,0.022919293f,0.0555788f,-0.06532679f,-0.06405401f,-0.004366455f,0.00994616f,0.07521969f,-0.033517595f,-0.01672006f,-0.08314669f,0.023051437f}),

            // The following points have identical vectors, but different payloads and point ids
            // For this case the pagination sorting is not guaranteed to be stable
            new(id: PointId.Integer(1), payload: """{"surrogate_key":"0_1005006449892408"}""", vector: new float[]{0.020560853f,0.010648917f,0.019934483f,0.025892029f,-0.022391383f,-0.01049979f,-0.09393914f,0.024376601f,0.026343381f,0.018441249f,-0.004123667f,-0.06678817f,0.010760794f,-0.041466597f,-0.017162103f,-0.0135723865f,0.0683297f,0.050452072f,-0.04898734f,-0.012887904f,0.027747203f,0.03738528f,0.0138300825f,0.061201517f,-0.0213791f,0.02333532f,0.008369495f,0.0027797017f,0.03082746f,-0.012138996f,0.0042152973f,0.005201215f,0.021399964f,-0.0054481756f,-0.040192477f,-0.00082362373f,-0.0055561922f,-0.026501859f,-0.012873947f,-0.04481291f,0.012996873f,0.03948901f,0.013191806f,-0.033325996f,0.053293526f,-0.03769621f,-0.030911626f,-0.010856354f,-0.039037872f,-0.02047758f,0.06785785f,-0.035479628f,-0.015177677f,-0.024222577f,0.031071212f,0.015855784f,0.029563783f,-0.04247646f,0.0051924502f,-0.036050268f,-0.064744964f,-0.06166824f,-0.0036784061f,0.07659485f,-0.0035642548f,-0.0015572591f,-0.047599897f,0.024961922f,-0.106141895f,-0.045185287f,0.012291628f,0.014731106f,-0.0060012075f,-0.0064465296f,0.019014439f,0.019751944f,-0.082181126f,0.030223029f,0.068705045f,-0.04053995f,-0.014920792f,0.028232414f,0.11018577f,-0.00465924f,-0.024392992f,-0.0174242f,0.0925475f,-0.013487573f,0.060842767f,0.008235506f,0.04956203f,-0.0063394024f,-0.10972843f,0.048718844f,0.04490825f,-0.0090214005f,-0.029762482f,0.07770023f,0.047469087f,0.069078594f,-0.02542715f,0.008477705f,0.048138786f,0.045767926f,0.00465573f,-0.07815844f,-0.059604146f,-0.02678565f,-0.034713715f,0.043282263f,-0.0013328533f,-0.030106476f,0.046143495f,0.03192009f,0.05372012f,0.066537686f,0.013526175f,-0.02561803f,-0.02873657f,0.0074283816f,-0.012882921f,-0.016263613f,-0.011150642f,-0.114378415f,0.037339732f,-0.024671486f,-0.052898765f,0.0002553807f,0.008643671f,0.022310626f,0.048788887f,0.038162988f,0.029083634f,-0.026201682f,-0.012504945f,-0.002685283f,0.0072236015f,0.015770499f,-0.046753973f,0.023923764f,-0.016790083f,0.0065246387f,0.074388795f,0.04346739f,0.05556957f,-0.052249026f,-0.039322924f,0.008354133f,0.0037516542f,0.02449631f,-0.046340715f,-0.031694166f,0.037636522f,-0.00397034f,-0.0035430433f,0.018797502f,0.023699949f,0.020500427f,0.03166326f,0.04769568f,-0.046923406f,-0.009048573f,-0.0009656419f,0.062242538f,0.005571201f,-0.033136543f,-0.043245036f,-0.011024001f,0.028051762f,-0.023141634f,-0.0032782592f,0.02592294f,-0.022165855f,-0.017334202f,0.020224886f,-0.041712318f,-0.04991717f,0.04107204f,0.11510602f,-0.014653281f,0.04215323f,0.031106375f,-0.024435245f,-0.050726168f,-0.007592285f,-0.0330459f,-0.02907672f,-0.02846832f,0.009943902f,0.023997335f,0.014418562f,0.08053775f,-0.08959843f,0.065692656f,-0.039781887f,-0.024684973f,-0.049556527f,-0.022664195f,-0.036654904f,0.0069104554f,0.016868113f,-0.047161244f,0.023084808f,0.051708806f,-0.021191005f,-0.023831006f,0.024127532f,-0.010830171f,-0.05165648f,-0.0012516129f,-0.0047492483f,-0.001633825f,-0.027780892f,-0.015114714f,-0.06472788f,0.009633433f,-0.037547786f,0.017774476f,0.05716087f,-0.020128239f,0.05204486f,0.0022620787f,0.00855987f,0.04088509f,-0.023306776f,-0.06583503f,0.018937862f,0.024344705f,0.031310167f,-0.07357539f,-0.01929243f,-0.045792248f,0.0068844524f,-0.008325207f,-0.09691286f,0.032810286f,0.0035979564f,0.046239436f,0.0052939747f,0.007917678f,0.0035850704f,-0.04890881f,0.11895362f,0.041076895f,-0.010067145f,0.04947348f,0.008941087f,0.034730382f,-0.006524886f,0.12708572f,-0.041195657f,-0.03775499f,-0.108981416f,0.00078196905f,-0.03169794f,-0.072490506f,-0.019292366f,-0.047594912f,-0.036551557f,0.041675508f,0.04338951f,0.0070932405f,-0.037702817f,0.017914655f,-0.03182354f,-0.036600374f,0.00035709303f,-0.010282118f,-0.035057086f,-0.05006926f,0.055976335f,-0.0077699996f,0.022679634f,-0.07229022f,0.037398335f,0.03869875f,-0.046844885f,-0.009903563f,0.031629894f,0.033678275f,-0.05391574f,-0.03382746f,8.164898E-05f,0.003220176f,0.08638492f,-0.0010051947f,-0.006364233f,-0.029976254f,-0.044577323f,0.019405864f,0.0017573284f,0.08046375f,-0.006766849f,0.035608478f,0.019357424f,0.09097412f,0.0012605522f,0.0037462127f,0.050070908f,-0.054035224f,-0.057656348f,-0.038486116f,0.021075474f,-0.015021469f,-0.023834642f,0.036805447f,-0.084733285f,-0.0057529975f,0.05881688f,-0.04014786f,0.1580715f,0.021954332f,-0.022357494f,0.037577223f,0.015248529f,-0.0004182503f,-0.008534981f,-0.005772731f,-0.0035374863f,0.025502887f,-0.05259507f,-0.009467596f,-0.0069260392f,-0.0013414021f,-0.115331605f,0.021514956f,-0.016434208f,-0.054133482f,0.0018750615f,0.014754077f,0.023164818f,-0.028966118f,-0.0015618426f,-0.061562024f,-0.057776984f,-0.025500927f,-0.05049469f,-0.009592856f,-0.021759752f,0.018032806f,0.06759455f,0.040157985f,0.044130597f,-0.0013099826f,0.029257577f,-0.06321642f,-0.0023867318f,0.012103608f,-0.016586933f,-0.0015177176f,-0.0073607294f,0.073907726f,0.016982755f,0.01744191f,-0.036158416f,-0.042620935f,-0.020303376f,-0.076988555f,0.028858839f,0.05396309f,0.0047656004f,0.0617689f,-0.03323128f,-0.051790413f,0.0031306453f,-0.024131848f,-0.05412007f,0.012733399f,-0.029755604f,-0.06976947f,0.029004745f,-0.067195505f,-0.013071256f,0.051913932f,-0.033411797f,-0.02340247f,0.04423931f,-0.06985532f,0.03288164f,-0.07071406f,-0.03793524f,0.028512005f,0.08190871f,0.04292977f,-0.0021712154f,0.01264322f,-0.020797629f,0.03208788f,0.055162657f,0.0016148452f,0.015570572f,0.07727553f,0.03015126f,0.041424397f,0.0030022874f,0.034349147f,0.026520291f,0.016016107f,0.011037036f,0.01226648f,0.032806084f,-0.006967154f,-0.0079680225f,-0.0009826083f,-0.052943338f,0.012229745f,-0.040051755f,-0.020608053f,0.02316282f,-0.006673265f,0.0018367835f,0.025904581f,-0.008980484f,-0.016705468f,-0.0650012f,-0.028585697f,0.10923479f,-0.009531084f,0.07226177f,-0.015751744f,-0.0569634f,0.072144106f,-0.020176293f,0.024882268f,0.077337004f,-0.100704536f,-0.030463822f,-0.016073583f,0.03189492f,0.024718104f,0.00535341f,0.0043743136f,-0.027010033f,0.014088915f,-0.014794507f,0.028242843f,0.11176037f,-0.03238486f,0.08016061f,0.0061242515f,-0.013684403f,0.00304748f,0.027243948f,-0.04560787f,0.034038004f,0.056840252f,0.04232895f,0.0049491893f,0.006670255f,-0.035278264f,-0.08407861f,-0.06428213f,-0.004121672f,-0.022436414f,0.064734325f,0.024700103f,-0.047622852f,0.047240857f,-0.025188314f,-0.06411069f,0.066141635f,-0.066100396f,-0.037653558f,-0.07993234f,0.029930798f,-0.019337416f,-0.007640354f,0.003971166f,-0.024443032f,0.038895197f,0.038598977f,0.060647234f,0.018201817f,-0.011513723f,-0.047726464f,0.011739284f,0.02038385f,-0.01863843f,-0.0121716205f,0.0406346f,-0.02844591f,-0.023326602f,0.0397463f,-0.022273367f,0.0074657574f,0.014157242f,-0.021250967f,-0.051852066f,-0.030340606f,-0.005509147f,-0.11746068f,0.015528121f,-0.037897293f,0.049813528f,-0.024971047f,0.0064871507f,0.032726087f,0.022233063f,0.074139185f,0.04076141f,-0.014732173f,0.008179707f,0.03506244f,-0.060515776f,0.018163972f,-0.059671838f,0.01654515f,-0.015666554f,-0.017981727f,0.047716398f,0.0041694343f,-0.04481842f,0.006958289f,-0.0076244646f,0.07952198f,0.00047137268f,-0.022086246f,-0.0010023455f,0.07064799f,-0.018951403f,0.025453633f,0.00889491f,0.04680934f,-0.015712436f,-0.019722331f,-0.028648023f,-0.0136769535f,-0.032791007f,-0.022751438f,-0.004541196f,-0.059959937f,0.0006311428f,0.051897854f,0.017315006f,-0.006265934f,-0.023401577f,0.010874158f,0.04593105f,-0.047464713f,0.026298115f,-0.046319354f,0.006788574f,0.047880437f,0.08423241f,0.018548327f,0.037229754f,0.0531647f,-0.014427742f,0.00315871f,0.05445105f,-0.03847716f,0.001980926f,0.015816873f,-0.12092872f,-0.033527393f,0.020468561f,0.045792133f,0.0530266f,-0.10163443f,-0.014012209f,-0.05038387f,0.066303186f,-0.021326113f,0.0652915f,-0.004896876f,0.023939338f,0.056339025f,-0.06859314f,-0.05673742f,-0.018077947f,0.0017880622f,0.08519749f,-0.023884917f,-0.01676656f,-0.07335844f,0.025956234f}),
            new(id: PointId.Integer(2), payload: """{"surrogate_key":"0_1005009084906428"}""", vector: new float[]{0.020560853f,0.010648917f,0.019934483f,0.025892029f,-0.022391383f,-0.01049979f,-0.09393914f,0.024376601f,0.026343381f,0.018441249f,-0.004123667f,-0.06678817f,0.010760794f,-0.041466597f,-0.017162103f,-0.0135723865f,0.0683297f,0.050452072f,-0.04898734f,-0.012887904f,0.027747203f,0.03738528f,0.0138300825f,0.061201517f,-0.0213791f,0.02333532f,0.008369495f,0.0027797017f,0.03082746f,-0.012138996f,0.0042152973f,0.005201215f,0.021399964f,-0.0054481756f,-0.040192477f,-0.00082362373f,-0.0055561922f,-0.026501859f,-0.012873947f,-0.04481291f,0.012996873f,0.03948901f,0.013191806f,-0.033325996f,0.053293526f,-0.03769621f,-0.030911626f,-0.010856354f,-0.039037872f,-0.02047758f,0.06785785f,-0.035479628f,-0.015177677f,-0.024222577f,0.031071212f,0.015855784f,0.029563783f,-0.04247646f,0.0051924502f,-0.036050268f,-0.064744964f,-0.06166824f,-0.0036784061f,0.07659485f,-0.0035642548f,-0.0015572591f,-0.047599897f,0.024961922f,-0.106141895f,-0.045185287f,0.012291628f,0.014731106f,-0.0060012075f,-0.0064465296f,0.019014439f,0.019751944f,-0.082181126f,0.030223029f,0.068705045f,-0.04053995f,-0.014920792f,0.028232414f,0.11018577f,-0.00465924f,-0.024392992f,-0.0174242f,0.0925475f,-0.013487573f,0.060842767f,0.008235506f,0.04956203f,-0.0063394024f,-0.10972843f,0.048718844f,0.04490825f,-0.0090214005f,-0.029762482f,0.07770023f,0.047469087f,0.069078594f,-0.02542715f,0.008477705f,0.048138786f,0.045767926f,0.00465573f,-0.07815844f,-0.059604146f,-0.02678565f,-0.034713715f,0.043282263f,-0.0013328533f,-0.030106476f,0.046143495f,0.03192009f,0.05372012f,0.066537686f,0.013526175f,-0.02561803f,-0.02873657f,0.0074283816f,-0.012882921f,-0.016263613f,-0.011150642f,-0.114378415f,0.037339732f,-0.024671486f,-0.052898765f,0.0002553807f,0.008643671f,0.022310626f,0.048788887f,0.038162988f,0.029083634f,-0.026201682f,-0.012504945f,-0.002685283f,0.0072236015f,0.015770499f,-0.046753973f,0.023923764f,-0.016790083f,0.0065246387f,0.074388795f,0.04346739f,0.05556957f,-0.052249026f,-0.039322924f,0.008354133f,0.0037516542f,0.02449631f,-0.046340715f,-0.031694166f,0.037636522f,-0.00397034f,-0.0035430433f,0.018797502f,0.023699949f,0.020500427f,0.03166326f,0.04769568f,-0.046923406f,-0.009048573f,-0.0009656419f,0.062242538f,0.005571201f,-0.033136543f,-0.043245036f,-0.011024001f,0.028051762f,-0.023141634f,-0.0032782592f,0.02592294f,-0.022165855f,-0.017334202f,0.020224886f,-0.041712318f,-0.04991717f,0.04107204f,0.11510602f,-0.014653281f,0.04215323f,0.031106375f,-0.024435245f,-0.050726168f,-0.007592285f,-0.0330459f,-0.02907672f,-0.02846832f,0.009943902f,0.023997335f,0.014418562f,0.08053775f,-0.08959843f,0.065692656f,-0.039781887f,-0.024684973f,-0.049556527f,-0.022664195f,-0.036654904f,0.0069104554f,0.016868113f,-0.047161244f,0.023084808f,0.051708806f,-0.021191005f,-0.023831006f,0.024127532f,-0.010830171f,-0.05165648f,-0.0012516129f,-0.0047492483f,-0.001633825f,-0.027780892f,-0.015114714f,-0.06472788f,0.009633433f,-0.037547786f,0.017774476f,0.05716087f,-0.020128239f,0.05204486f,0.0022620787f,0.00855987f,0.04088509f,-0.023306776f,-0.06583503f,0.018937862f,0.024344705f,0.031310167f,-0.07357539f,-0.01929243f,-0.045792248f,0.0068844524f,-0.008325207f,-0.09691286f,0.032810286f,0.0035979564f,0.046239436f,0.0052939747f,0.007917678f,0.0035850704f,-0.04890881f,0.11895362f,0.041076895f,-0.010067145f,0.04947348f,0.008941087f,0.034730382f,-0.006524886f,0.12708572f,-0.041195657f,-0.03775499f,-0.108981416f,0.00078196905f,-0.03169794f,-0.072490506f,-0.019292366f,-0.047594912f,-0.036551557f,0.041675508f,0.04338951f,0.0070932405f,-0.037702817f,0.017914655f,-0.03182354f,-0.036600374f,0.00035709303f,-0.010282118f,-0.035057086f,-0.05006926f,0.055976335f,-0.0077699996f,0.022679634f,-0.07229022f,0.037398335f,0.03869875f,-0.046844885f,-0.009903563f,0.031629894f,0.033678275f,-0.05391574f,-0.03382746f,8.164898E-05f,0.003220176f,0.08638492f,-0.0010051947f,-0.006364233f,-0.029976254f,-0.044577323f,0.019405864f,0.0017573284f,0.08046375f,-0.006766849f,0.035608478f,0.019357424f,0.09097412f,0.0012605522f,0.0037462127f,0.050070908f,-0.054035224f,-0.057656348f,-0.038486116f,0.021075474f,-0.015021469f,-0.023834642f,0.036805447f,-0.084733285f,-0.0057529975f,0.05881688f,-0.04014786f,0.1580715f,0.021954332f,-0.022357494f,0.037577223f,0.015248529f,-0.0004182503f,-0.008534981f,-0.005772731f,-0.0035374863f,0.025502887f,-0.05259507f,-0.009467596f,-0.0069260392f,-0.0013414021f,-0.115331605f,0.021514956f,-0.016434208f,-0.054133482f,0.0018750615f,0.014754077f,0.023164818f,-0.028966118f,-0.0015618426f,-0.061562024f,-0.057776984f,-0.025500927f,-0.05049469f,-0.009592856f,-0.021759752f,0.018032806f,0.06759455f,0.040157985f,0.044130597f,-0.0013099826f,0.029257577f,-0.06321642f,-0.0023867318f,0.012103608f,-0.016586933f,-0.0015177176f,-0.0073607294f,0.073907726f,0.016982755f,0.01744191f,-0.036158416f,-0.042620935f,-0.020303376f,-0.076988555f,0.028858839f,0.05396309f,0.0047656004f,0.0617689f,-0.03323128f,-0.051790413f,0.0031306453f,-0.024131848f,-0.05412007f,0.012733399f,-0.029755604f,-0.06976947f,0.029004745f,-0.067195505f,-0.013071256f,0.051913932f,-0.033411797f,-0.02340247f,0.04423931f,-0.06985532f,0.03288164f,-0.07071406f,-0.03793524f,0.028512005f,0.08190871f,0.04292977f,-0.0021712154f,0.01264322f,-0.020797629f,0.03208788f,0.055162657f,0.0016148452f,0.015570572f,0.07727553f,0.03015126f,0.041424397f,0.0030022874f,0.034349147f,0.026520291f,0.016016107f,0.011037036f,0.01226648f,0.032806084f,-0.006967154f,-0.0079680225f,-0.0009826083f,-0.052943338f,0.012229745f,-0.040051755f,-0.020608053f,0.02316282f,-0.006673265f,0.0018367835f,0.025904581f,-0.008980484f,-0.016705468f,-0.0650012f,-0.028585697f,0.10923479f,-0.009531084f,0.07226177f,-0.015751744f,-0.0569634f,0.072144106f,-0.020176293f,0.024882268f,0.077337004f,-0.100704536f,-0.030463822f,-0.016073583f,0.03189492f,0.024718104f,0.00535341f,0.0043743136f,-0.027010033f,0.014088915f,-0.014794507f,0.028242843f,0.11176037f,-0.03238486f,0.08016061f,0.0061242515f,-0.013684403f,0.00304748f,0.027243948f,-0.04560787f,0.034038004f,0.056840252f,0.04232895f,0.0049491893f,0.006670255f,-0.035278264f,-0.08407861f,-0.06428213f,-0.004121672f,-0.022436414f,0.064734325f,0.024700103f,-0.047622852f,0.047240857f,-0.025188314f,-0.06411069f,0.066141635f,-0.066100396f,-0.037653558f,-0.07993234f,0.029930798f,-0.019337416f,-0.007640354f,0.003971166f,-0.024443032f,0.038895197f,0.038598977f,0.060647234f,0.018201817f,-0.011513723f,-0.047726464f,0.011739284f,0.02038385f,-0.01863843f,-0.0121716205f,0.0406346f,-0.02844591f,-0.023326602f,0.0397463f,-0.022273367f,0.0074657574f,0.014157242f,-0.021250967f,-0.051852066f,-0.030340606f,-0.005509147f,-0.11746068f,0.015528121f,-0.037897293f,0.049813528f,-0.024971047f,0.0064871507f,0.032726087f,0.022233063f,0.074139185f,0.04076141f,-0.014732173f,0.008179707f,0.03506244f,-0.060515776f,0.018163972f,-0.059671838f,0.01654515f,-0.015666554f,-0.017981727f,0.047716398f,0.0041694343f,-0.04481842f,0.006958289f,-0.0076244646f,0.07952198f,0.00047137268f,-0.022086246f,-0.0010023455f,0.07064799f,-0.018951403f,0.025453633f,0.00889491f,0.04680934f,-0.015712436f,-0.019722331f,-0.028648023f,-0.0136769535f,-0.032791007f,-0.022751438f,-0.004541196f,-0.059959937f,0.0006311428f,0.051897854f,0.017315006f,-0.006265934f,-0.023401577f,0.010874158f,0.04593105f,-0.047464713f,0.026298115f,-0.046319354f,0.006788574f,0.047880437f,0.08423241f,0.018548327f,0.037229754f,0.0531647f,-0.014427742f,0.00315871f,0.05445105f,-0.03847716f,0.001980926f,0.015816873f,-0.12092872f,-0.033527393f,0.020468561f,0.045792133f,0.0530266f,-0.10163443f,-0.014012209f,-0.05038387f,0.066303186f,-0.021326113f,0.0652915f,-0.004896876f,0.023939338f,0.056339025f,-0.06859314f,-0.05673742f,-0.018077947f,0.0017880622f,0.08519749f,-0.023884917f,-0.01676656f,-0.07335844f,0.025956234f}),
            new(id: PointId.Integer(3), payload: """{"surrogate_key":"0_1005009021844138"}""", vector: new float[]{0.020560853f,0.010648917f,0.019934483f,0.025892029f,-0.022391383f,-0.01049979f,-0.09393914f,0.024376601f,0.026343381f,0.018441249f,-0.004123667f,-0.06678817f,0.010760794f,-0.041466597f,-0.017162103f,-0.0135723865f,0.0683297f,0.050452072f,-0.04898734f,-0.012887904f,0.027747203f,0.03738528f,0.0138300825f,0.061201517f,-0.0213791f,0.02333532f,0.008369495f,0.0027797017f,0.03082746f,-0.012138996f,0.0042152973f,0.005201215f,0.021399964f,-0.0054481756f,-0.040192477f,-0.00082362373f,-0.0055561922f,-0.026501859f,-0.012873947f,-0.04481291f,0.012996873f,0.03948901f,0.013191806f,-0.033325996f,0.053293526f,-0.03769621f,-0.030911626f,-0.010856354f,-0.039037872f,-0.02047758f,0.06785785f,-0.035479628f,-0.015177677f,-0.024222577f,0.031071212f,0.015855784f,0.029563783f,-0.04247646f,0.0051924502f,-0.036050268f,-0.064744964f,-0.06166824f,-0.0036784061f,0.07659485f,-0.0035642548f,-0.0015572591f,-0.047599897f,0.024961922f,-0.106141895f,-0.045185287f,0.012291628f,0.014731106f,-0.0060012075f,-0.0064465296f,0.019014439f,0.019751944f,-0.082181126f,0.030223029f,0.068705045f,-0.04053995f,-0.014920792f,0.028232414f,0.11018577f,-0.00465924f,-0.024392992f,-0.0174242f,0.0925475f,-0.013487573f,0.060842767f,0.008235506f,0.04956203f,-0.0063394024f,-0.10972843f,0.048718844f,0.04490825f,-0.0090214005f,-0.029762482f,0.07770023f,0.047469087f,0.069078594f,-0.02542715f,0.008477705f,0.048138786f,0.045767926f,0.00465573f,-0.07815844f,-0.059604146f,-0.02678565f,-0.034713715f,0.043282263f,-0.0013328533f,-0.030106476f,0.046143495f,0.03192009f,0.05372012f,0.066537686f,0.013526175f,-0.02561803f,-0.02873657f,0.0074283816f,-0.012882921f,-0.016263613f,-0.011150642f,-0.114378415f,0.037339732f,-0.024671486f,-0.052898765f,0.0002553807f,0.008643671f,0.022310626f,0.048788887f,0.038162988f,0.029083634f,-0.026201682f,-0.012504945f,-0.002685283f,0.0072236015f,0.015770499f,-0.046753973f,0.023923764f,-0.016790083f,0.0065246387f,0.074388795f,0.04346739f,0.05556957f,-0.052249026f,-0.039322924f,0.008354133f,0.0037516542f,0.02449631f,-0.046340715f,-0.031694166f,0.037636522f,-0.00397034f,-0.0035430433f,0.018797502f,0.023699949f,0.020500427f,0.03166326f,0.04769568f,-0.046923406f,-0.009048573f,-0.0009656419f,0.062242538f,0.005571201f,-0.033136543f,-0.043245036f,-0.011024001f,0.028051762f,-0.023141634f,-0.0032782592f,0.02592294f,-0.022165855f,-0.017334202f,0.020224886f,-0.041712318f,-0.04991717f,0.04107204f,0.11510602f,-0.014653281f,0.04215323f,0.031106375f,-0.024435245f,-0.050726168f,-0.007592285f,-0.0330459f,-0.02907672f,-0.02846832f,0.009943902f,0.023997335f,0.014418562f,0.08053775f,-0.08959843f,0.065692656f,-0.039781887f,-0.024684973f,-0.049556527f,-0.022664195f,-0.036654904f,0.0069104554f,0.016868113f,-0.047161244f,0.023084808f,0.051708806f,-0.021191005f,-0.023831006f,0.024127532f,-0.010830171f,-0.05165648f,-0.0012516129f,-0.0047492483f,-0.001633825f,-0.027780892f,-0.015114714f,-0.06472788f,0.009633433f,-0.037547786f,0.017774476f,0.05716087f,-0.020128239f,0.05204486f,0.0022620787f,0.00855987f,0.04088509f,-0.023306776f,-0.06583503f,0.018937862f,0.024344705f,0.031310167f,-0.07357539f,-0.01929243f,-0.045792248f,0.0068844524f,-0.008325207f,-0.09691286f,0.032810286f,0.0035979564f,0.046239436f,0.0052939747f,0.007917678f,0.0035850704f,-0.04890881f,0.11895362f,0.041076895f,-0.010067145f,0.04947348f,0.008941087f,0.034730382f,-0.006524886f,0.12708572f,-0.041195657f,-0.03775499f,-0.108981416f,0.00078196905f,-0.03169794f,-0.072490506f,-0.019292366f,-0.047594912f,-0.036551557f,0.041675508f,0.04338951f,0.0070932405f,-0.037702817f,0.017914655f,-0.03182354f,-0.036600374f,0.00035709303f,-0.010282118f,-0.035057086f,-0.05006926f,0.055976335f,-0.0077699996f,0.022679634f,-0.07229022f,0.037398335f,0.03869875f,-0.046844885f,-0.009903563f,0.031629894f,0.033678275f,-0.05391574f,-0.03382746f,8.164898E-05f,0.003220176f,0.08638492f,-0.0010051947f,-0.006364233f,-0.029976254f,-0.044577323f,0.019405864f,0.0017573284f,0.08046375f,-0.006766849f,0.035608478f,0.019357424f,0.09097412f,0.0012605522f,0.0037462127f,0.050070908f,-0.054035224f,-0.057656348f,-0.038486116f,0.021075474f,-0.015021469f,-0.023834642f,0.036805447f,-0.084733285f,-0.0057529975f,0.05881688f,-0.04014786f,0.1580715f,0.021954332f,-0.022357494f,0.037577223f,0.015248529f,-0.0004182503f,-0.008534981f,-0.005772731f,-0.0035374863f,0.025502887f,-0.05259507f,-0.009467596f,-0.0069260392f,-0.0013414021f,-0.115331605f,0.021514956f,-0.016434208f,-0.054133482f,0.0018750615f,0.014754077f,0.023164818f,-0.028966118f,-0.0015618426f,-0.061562024f,-0.057776984f,-0.025500927f,-0.05049469f,-0.009592856f,-0.021759752f,0.018032806f,0.06759455f,0.040157985f,0.044130597f,-0.0013099826f,0.029257577f,-0.06321642f,-0.0023867318f,0.012103608f,-0.016586933f,-0.0015177176f,-0.0073607294f,0.073907726f,0.016982755f,0.01744191f,-0.036158416f,-0.042620935f,-0.020303376f,-0.076988555f,0.028858839f,0.05396309f,0.0047656004f,0.0617689f,-0.03323128f,-0.051790413f,0.0031306453f,-0.024131848f,-0.05412007f,0.012733399f,-0.029755604f,-0.06976947f,0.029004745f,-0.067195505f,-0.013071256f,0.051913932f,-0.033411797f,-0.02340247f,0.04423931f,-0.06985532f,0.03288164f,-0.07071406f,-0.03793524f,0.028512005f,0.08190871f,0.04292977f,-0.0021712154f,0.01264322f,-0.020797629f,0.03208788f,0.055162657f,0.0016148452f,0.015570572f,0.07727553f,0.03015126f,0.041424397f,0.0030022874f,0.034349147f,0.026520291f,0.016016107f,0.011037036f,0.01226648f,0.032806084f,-0.006967154f,-0.0079680225f,-0.0009826083f,-0.052943338f,0.012229745f,-0.040051755f,-0.020608053f,0.02316282f,-0.006673265f,0.0018367835f,0.025904581f,-0.008980484f,-0.016705468f,-0.0650012f,-0.028585697f,0.10923479f,-0.009531084f,0.07226177f,-0.015751744f,-0.0569634f,0.072144106f,-0.020176293f,0.024882268f,0.077337004f,-0.100704536f,-0.030463822f,-0.016073583f,0.03189492f,0.024718104f,0.00535341f,0.0043743136f,-0.027010033f,0.014088915f,-0.014794507f,0.028242843f,0.11176037f,-0.03238486f,0.08016061f,0.0061242515f,-0.013684403f,0.00304748f,0.027243948f,-0.04560787f,0.034038004f,0.056840252f,0.04232895f,0.0049491893f,0.006670255f,-0.035278264f,-0.08407861f,-0.06428213f,-0.004121672f,-0.022436414f,0.064734325f,0.024700103f,-0.047622852f,0.047240857f,-0.025188314f,-0.06411069f,0.066141635f,-0.066100396f,-0.037653558f,-0.07993234f,0.029930798f,-0.019337416f,-0.007640354f,0.003971166f,-0.024443032f,0.038895197f,0.038598977f,0.060647234f,0.018201817f,-0.011513723f,-0.047726464f,0.011739284f,0.02038385f,-0.01863843f,-0.0121716205f,0.0406346f,-0.02844591f,-0.023326602f,0.0397463f,-0.022273367f,0.0074657574f,0.014157242f,-0.021250967f,-0.051852066f,-0.030340606f,-0.005509147f,-0.11746068f,0.015528121f,-0.037897293f,0.049813528f,-0.024971047f,0.0064871507f,0.032726087f,0.022233063f,0.074139185f,0.04076141f,-0.014732173f,0.008179707f,0.03506244f,-0.060515776f,0.018163972f,-0.059671838f,0.01654515f,-0.015666554f,-0.017981727f,0.047716398f,0.0041694343f,-0.04481842f,0.006958289f,-0.0076244646f,0.07952198f,0.00047137268f,-0.022086246f,-0.0010023455f,0.07064799f,-0.018951403f,0.025453633f,0.00889491f,0.04680934f,-0.015712436f,-0.019722331f,-0.028648023f,-0.0136769535f,-0.032791007f,-0.022751438f,-0.004541196f,-0.059959937f,0.0006311428f,0.051897854f,0.017315006f,-0.006265934f,-0.023401577f,0.010874158f,0.04593105f,-0.047464713f,0.026298115f,-0.046319354f,0.006788574f,0.047880437f,0.08423241f,0.018548327f,0.037229754f,0.0531647f,-0.014427742f,0.00315871f,0.05445105f,-0.03847716f,0.001980926f,0.015816873f,-0.12092872f,-0.033527393f,0.020468561f,0.045792133f,0.0530266f,-0.10163443f,-0.014012209f,-0.05038387f,0.066303186f,-0.021326113f,0.0652915f,-0.004896876f,0.023939338f,0.056339025f,-0.06859314f,-0.05673742f,-0.018077947f,0.0017880622f,0.08519749f,-0.023884917f,-0.01676656f,-0.07335844f,0.025956234f}),
            new(id: PointId.Integer(4), payload: """{"surrogate_key":"0_1005007623580346"}""", vector: new float[]{0.020560853f,0.010648917f,0.019934483f,0.025892029f,-0.022391383f,-0.01049979f,-0.09393914f,0.024376601f,0.026343381f,0.018441249f,-0.004123667f,-0.06678817f,0.010760794f,-0.041466597f,-0.017162103f,-0.0135723865f,0.0683297f,0.050452072f,-0.04898734f,-0.012887904f,0.027747203f,0.03738528f,0.0138300825f,0.061201517f,-0.0213791f,0.02333532f,0.008369495f,0.0027797017f,0.03082746f,-0.012138996f,0.0042152973f,0.005201215f,0.021399964f,-0.0054481756f,-0.040192477f,-0.00082362373f,-0.0055561922f,-0.026501859f,-0.012873947f,-0.04481291f,0.012996873f,0.03948901f,0.013191806f,-0.033325996f,0.053293526f,-0.03769621f,-0.030911626f,-0.010856354f,-0.039037872f,-0.02047758f,0.06785785f,-0.035479628f,-0.015177677f,-0.024222577f,0.031071212f,0.015855784f,0.029563783f,-0.04247646f,0.0051924502f,-0.036050268f,-0.064744964f,-0.06166824f,-0.0036784061f,0.07659485f,-0.0035642548f,-0.0015572591f,-0.047599897f,0.024961922f,-0.106141895f,-0.045185287f,0.012291628f,0.014731106f,-0.0060012075f,-0.0064465296f,0.019014439f,0.019751944f,-0.082181126f,0.030223029f,0.068705045f,-0.04053995f,-0.014920792f,0.028232414f,0.11018577f,-0.00465924f,-0.024392992f,-0.0174242f,0.0925475f,-0.013487573f,0.060842767f,0.008235506f,0.04956203f,-0.0063394024f,-0.10972843f,0.048718844f,0.04490825f,-0.0090214005f,-0.029762482f,0.07770023f,0.047469087f,0.069078594f,-0.02542715f,0.008477705f,0.048138786f,0.045767926f,0.00465573f,-0.07815844f,-0.059604146f,-0.02678565f,-0.034713715f,0.043282263f,-0.0013328533f,-0.030106476f,0.046143495f,0.03192009f,0.05372012f,0.066537686f,0.013526175f,-0.02561803f,-0.02873657f,0.0074283816f,-0.012882921f,-0.016263613f,-0.011150642f,-0.114378415f,0.037339732f,-0.024671486f,-0.052898765f,0.0002553807f,0.008643671f,0.022310626f,0.048788887f,0.038162988f,0.029083634f,-0.026201682f,-0.012504945f,-0.002685283f,0.0072236015f,0.015770499f,-0.046753973f,0.023923764f,-0.016790083f,0.0065246387f,0.074388795f,0.04346739f,0.05556957f,-0.052249026f,-0.039322924f,0.008354133f,0.0037516542f,0.02449631f,-0.046340715f,-0.031694166f,0.037636522f,-0.00397034f,-0.0035430433f,0.018797502f,0.023699949f,0.020500427f,0.03166326f,0.04769568f,-0.046923406f,-0.009048573f,-0.0009656419f,0.062242538f,0.005571201f,-0.033136543f,-0.043245036f,-0.011024001f,0.028051762f,-0.023141634f,-0.0032782592f,0.02592294f,-0.022165855f,-0.017334202f,0.020224886f,-0.041712318f,-0.04991717f,0.04107204f,0.11510602f,-0.014653281f,0.04215323f,0.031106375f,-0.024435245f,-0.050726168f,-0.007592285f,-0.0330459f,-0.02907672f,-0.02846832f,0.009943902f,0.023997335f,0.014418562f,0.08053775f,-0.08959843f,0.065692656f,-0.039781887f,-0.024684973f,-0.049556527f,-0.022664195f,-0.036654904f,0.0069104554f,0.016868113f,-0.047161244f,0.023084808f,0.051708806f,-0.021191005f,-0.023831006f,0.024127532f,-0.010830171f,-0.05165648f,-0.0012516129f,-0.0047492483f,-0.001633825f,-0.027780892f,-0.015114714f,-0.06472788f,0.009633433f,-0.037547786f,0.017774476f,0.05716087f,-0.020128239f,0.05204486f,0.0022620787f,0.00855987f,0.04088509f,-0.023306776f,-0.06583503f,0.018937862f,0.024344705f,0.031310167f,-0.07357539f,-0.01929243f,-0.045792248f,0.0068844524f,-0.008325207f,-0.09691286f,0.032810286f,0.0035979564f,0.046239436f,0.0052939747f,0.007917678f,0.0035850704f,-0.04890881f,0.11895362f,0.041076895f,-0.010067145f,0.04947348f,0.008941087f,0.034730382f,-0.006524886f,0.12708572f,-0.041195657f,-0.03775499f,-0.108981416f,0.00078196905f,-0.03169794f,-0.072490506f,-0.019292366f,-0.047594912f,-0.036551557f,0.041675508f,0.04338951f,0.0070932405f,-0.037702817f,0.017914655f,-0.03182354f,-0.036600374f,0.00035709303f,-0.010282118f,-0.035057086f,-0.05006926f,0.055976335f,-0.0077699996f,0.022679634f,-0.07229022f,0.037398335f,0.03869875f,-0.046844885f,-0.009903563f,0.031629894f,0.033678275f,-0.05391574f,-0.03382746f,8.164898E-05f,0.003220176f,0.08638492f,-0.0010051947f,-0.006364233f,-0.029976254f,-0.044577323f,0.019405864f,0.0017573284f,0.08046375f,-0.006766849f,0.035608478f,0.019357424f,0.09097412f,0.0012605522f,0.0037462127f,0.050070908f,-0.054035224f,-0.057656348f,-0.038486116f,0.021075474f,-0.015021469f,-0.023834642f,0.036805447f,-0.084733285f,-0.0057529975f,0.05881688f,-0.04014786f,0.1580715f,0.021954332f,-0.022357494f,0.037577223f,0.015248529f,-0.0004182503f,-0.008534981f,-0.005772731f,-0.0035374863f,0.025502887f,-0.05259507f,-0.009467596f,-0.0069260392f,-0.0013414021f,-0.115331605f,0.021514956f,-0.016434208f,-0.054133482f,0.0018750615f,0.014754077f,0.023164818f,-0.028966118f,-0.0015618426f,-0.061562024f,-0.057776984f,-0.025500927f,-0.05049469f,-0.009592856f,-0.021759752f,0.018032806f,0.06759455f,0.040157985f,0.044130597f,-0.0013099826f,0.029257577f,-0.06321642f,-0.0023867318f,0.012103608f,-0.016586933f,-0.0015177176f,-0.0073607294f,0.073907726f,0.016982755f,0.01744191f,-0.036158416f,-0.042620935f,-0.020303376f,-0.076988555f,0.028858839f,0.05396309f,0.0047656004f,0.0617689f,-0.03323128f,-0.051790413f,0.0031306453f,-0.024131848f,-0.05412007f,0.012733399f,-0.029755604f,-0.06976947f,0.029004745f,-0.067195505f,-0.013071256f,0.051913932f,-0.033411797f,-0.02340247f,0.04423931f,-0.06985532f,0.03288164f,-0.07071406f,-0.03793524f,0.028512005f,0.08190871f,0.04292977f,-0.0021712154f,0.01264322f,-0.020797629f,0.03208788f,0.055162657f,0.0016148452f,0.015570572f,0.07727553f,0.03015126f,0.041424397f,0.0030022874f,0.034349147f,0.026520291f,0.016016107f,0.011037036f,0.01226648f,0.032806084f,-0.006967154f,-0.0079680225f,-0.0009826083f,-0.052943338f,0.012229745f,-0.040051755f,-0.020608053f,0.02316282f,-0.006673265f,0.0018367835f,0.025904581f,-0.008980484f,-0.016705468f,-0.0650012f,-0.028585697f,0.10923479f,-0.009531084f,0.07226177f,-0.015751744f,-0.0569634f,0.072144106f,-0.020176293f,0.024882268f,0.077337004f,-0.100704536f,-0.030463822f,-0.016073583f,0.03189492f,0.024718104f,0.00535341f,0.0043743136f,-0.027010033f,0.014088915f,-0.014794507f,0.028242843f,0.11176037f,-0.03238486f,0.08016061f,0.0061242515f,-0.013684403f,0.00304748f,0.027243948f,-0.04560787f,0.034038004f,0.056840252f,0.04232895f,0.0049491893f,0.006670255f,-0.035278264f,-0.08407861f,-0.06428213f,-0.004121672f,-0.022436414f,0.064734325f,0.024700103f,-0.047622852f,0.047240857f,-0.025188314f,-0.06411069f,0.066141635f,-0.066100396f,-0.037653558f,-0.07993234f,0.029930798f,-0.019337416f,-0.007640354f,0.003971166f,-0.024443032f,0.038895197f,0.038598977f,0.060647234f,0.018201817f,-0.011513723f,-0.047726464f,0.011739284f,0.02038385f,-0.01863843f,-0.0121716205f,0.0406346f,-0.02844591f,-0.023326602f,0.0397463f,-0.022273367f,0.0074657574f,0.014157242f,-0.021250967f,-0.051852066f,-0.030340606f,-0.005509147f,-0.11746068f,0.015528121f,-0.037897293f,0.049813528f,-0.024971047f,0.0064871507f,0.032726087f,0.022233063f,0.074139185f,0.04076141f,-0.014732173f,0.008179707f,0.03506244f,-0.060515776f,0.018163972f,-0.059671838f,0.01654515f,-0.015666554f,-0.017981727f,0.047716398f,0.0041694343f,-0.04481842f,0.006958289f,-0.0076244646f,0.07952198f,0.00047137268f,-0.022086246f,-0.0010023455f,0.07064799f,-0.018951403f,0.025453633f,0.00889491f,0.04680934f,-0.015712436f,-0.019722331f,-0.028648023f,-0.0136769535f,-0.032791007f,-0.022751438f,-0.004541196f,-0.059959937f,0.0006311428f,0.051897854f,0.017315006f,-0.006265934f,-0.023401577f,0.010874158f,0.04593105f,-0.047464713f,0.026298115f,-0.046319354f,0.006788574f,0.047880437f,0.08423241f,0.018548327f,0.037229754f,0.0531647f,-0.014427742f,0.00315871f,0.05445105f,-0.03847716f,0.001980926f,0.015816873f,-0.12092872f,-0.033527393f,0.020468561f,0.045792133f,0.0530266f,-0.10163443f,-0.014012209f,-0.05038387f,0.066303186f,-0.021326113f,0.0652915f,-0.004896876f,0.023939338f,0.056339025f,-0.06859314f,-0.05673742f,-0.018077947f,0.0017880622f,0.08519749f,-0.023884917f,-0.01676656f,-0.07335844f,0.025956234f}),
            new(id: PointId.Integer(5), payload: """{"surrogate_key":"0_1005007269877819"}""", vector: new float[]{0.020560853f,0.010648917f,0.019934483f,0.025892029f,-0.022391383f,-0.01049979f,-0.09393914f,0.024376601f,0.026343381f,0.018441249f,-0.004123667f,-0.06678817f,0.010760794f,-0.041466597f,-0.017162103f,-0.0135723865f,0.0683297f,0.050452072f,-0.04898734f,-0.012887904f,0.027747203f,0.03738528f,0.0138300825f,0.061201517f,-0.0213791f,0.02333532f,0.008369495f,0.0027797017f,0.03082746f,-0.012138996f,0.0042152973f,0.005201215f,0.021399964f,-0.0054481756f,-0.040192477f,-0.00082362373f,-0.0055561922f,-0.026501859f,-0.012873947f,-0.04481291f,0.012996873f,0.03948901f,0.013191806f,-0.033325996f,0.053293526f,-0.03769621f,-0.030911626f,-0.010856354f,-0.039037872f,-0.02047758f,0.06785785f,-0.035479628f,-0.015177677f,-0.024222577f,0.031071212f,0.015855784f,0.029563783f,-0.04247646f,0.0051924502f,-0.036050268f,-0.064744964f,-0.06166824f,-0.0036784061f,0.07659485f,-0.0035642548f,-0.0015572591f,-0.047599897f,0.024961922f,-0.106141895f,-0.045185287f,0.012291628f,0.014731106f,-0.0060012075f,-0.0064465296f,0.019014439f,0.019751944f,-0.082181126f,0.030223029f,0.068705045f,-0.04053995f,-0.014920792f,0.028232414f,0.11018577f,-0.00465924f,-0.024392992f,-0.0174242f,0.0925475f,-0.013487573f,0.060842767f,0.008235506f,0.04956203f,-0.0063394024f,-0.10972843f,0.048718844f,0.04490825f,-0.0090214005f,-0.029762482f,0.07770023f,0.047469087f,0.069078594f,-0.02542715f,0.008477705f,0.048138786f,0.045767926f,0.00465573f,-0.07815844f,-0.059604146f,-0.02678565f,-0.034713715f,0.043282263f,-0.0013328533f,-0.030106476f,0.046143495f,0.03192009f,0.05372012f,0.066537686f,0.013526175f,-0.02561803f,-0.02873657f,0.0074283816f,-0.012882921f,-0.016263613f,-0.011150642f,-0.114378415f,0.037339732f,-0.024671486f,-0.052898765f,0.0002553807f,0.008643671f,0.022310626f,0.048788887f,0.038162988f,0.029083634f,-0.026201682f,-0.012504945f,-0.002685283f,0.0072236015f,0.015770499f,-0.046753973f,0.023923764f,-0.016790083f,0.0065246387f,0.074388795f,0.04346739f,0.05556957f,-0.052249026f,-0.039322924f,0.008354133f,0.0037516542f,0.02449631f,-0.046340715f,-0.031694166f,0.037636522f,-0.00397034f,-0.0035430433f,0.018797502f,0.023699949f,0.020500427f,0.03166326f,0.04769568f,-0.046923406f,-0.009048573f,-0.0009656419f,0.062242538f,0.005571201f,-0.033136543f,-0.043245036f,-0.011024001f,0.028051762f,-0.023141634f,-0.0032782592f,0.02592294f,-0.022165855f,-0.017334202f,0.020224886f,-0.041712318f,-0.04991717f,0.04107204f,0.11510602f,-0.014653281f,0.04215323f,0.031106375f,-0.024435245f,-0.050726168f,-0.007592285f,-0.0330459f,-0.02907672f,-0.02846832f,0.009943902f,0.023997335f,0.014418562f,0.08053775f,-0.08959843f,0.065692656f,-0.039781887f,-0.024684973f,-0.049556527f,-0.022664195f,-0.036654904f,0.0069104554f,0.016868113f,-0.047161244f,0.023084808f,0.051708806f,-0.021191005f,-0.023831006f,0.024127532f,-0.010830171f,-0.05165648f,-0.0012516129f,-0.0047492483f,-0.001633825f,-0.027780892f,-0.015114714f,-0.06472788f,0.009633433f,-0.037547786f,0.017774476f,0.05716087f,-0.020128239f,0.05204486f,0.0022620787f,0.00855987f,0.04088509f,-0.023306776f,-0.06583503f,0.018937862f,0.024344705f,0.031310167f,-0.07357539f,-0.01929243f,-0.045792248f,0.0068844524f,-0.008325207f,-0.09691286f,0.032810286f,0.0035979564f,0.046239436f,0.0052939747f,0.007917678f,0.0035850704f,-0.04890881f,0.11895362f,0.041076895f,-0.010067145f,0.04947348f,0.008941087f,0.034730382f,-0.006524886f,0.12708572f,-0.041195657f,-0.03775499f,-0.108981416f,0.00078196905f,-0.03169794f,-0.072490506f,-0.019292366f,-0.047594912f,-0.036551557f,0.041675508f,0.04338951f,0.0070932405f,-0.037702817f,0.017914655f,-0.03182354f,-0.036600374f,0.00035709303f,-0.010282118f,-0.035057086f,-0.05006926f,0.055976335f,-0.0077699996f,0.022679634f,-0.07229022f,0.037398335f,0.03869875f,-0.046844885f,-0.009903563f,0.031629894f,0.033678275f,-0.05391574f,-0.03382746f,8.164898E-05f,0.003220176f,0.08638492f,-0.0010051947f,-0.006364233f,-0.029976254f,-0.044577323f,0.019405864f,0.0017573284f,0.08046375f,-0.006766849f,0.035608478f,0.019357424f,0.09097412f,0.0012605522f,0.0037462127f,0.050070908f,-0.054035224f,-0.057656348f,-0.038486116f,0.021075474f,-0.015021469f,-0.023834642f,0.036805447f,-0.084733285f,-0.0057529975f,0.05881688f,-0.04014786f,0.1580715f,0.021954332f,-0.022357494f,0.037577223f,0.015248529f,-0.0004182503f,-0.008534981f,-0.005772731f,-0.0035374863f,0.025502887f,-0.05259507f,-0.009467596f,-0.0069260392f,-0.0013414021f,-0.115331605f,0.021514956f,-0.016434208f,-0.054133482f,0.0018750615f,0.014754077f,0.023164818f,-0.028966118f,-0.0015618426f,-0.061562024f,-0.057776984f,-0.025500927f,-0.05049469f,-0.009592856f,-0.021759752f,0.018032806f,0.06759455f,0.040157985f,0.044130597f,-0.0013099826f,0.029257577f,-0.06321642f,-0.0023867318f,0.012103608f,-0.016586933f,-0.0015177176f,-0.0073607294f,0.073907726f,0.016982755f,0.01744191f,-0.036158416f,-0.042620935f,-0.020303376f,-0.076988555f,0.028858839f,0.05396309f,0.0047656004f,0.0617689f,-0.03323128f,-0.051790413f,0.0031306453f,-0.024131848f,-0.05412007f,0.012733399f,-0.029755604f,-0.06976947f,0.029004745f,-0.067195505f,-0.013071256f,0.051913932f,-0.033411797f,-0.02340247f,0.04423931f,-0.06985532f,0.03288164f,-0.07071406f,-0.03793524f,0.028512005f,0.08190871f,0.04292977f,-0.0021712154f,0.01264322f,-0.020797629f,0.03208788f,0.055162657f,0.0016148452f,0.015570572f,0.07727553f,0.03015126f,0.041424397f,0.0030022874f,0.034349147f,0.026520291f,0.016016107f,0.011037036f,0.01226648f,0.032806084f,-0.006967154f,-0.0079680225f,-0.0009826083f,-0.052943338f,0.012229745f,-0.040051755f,-0.020608053f,0.02316282f,-0.006673265f,0.0018367835f,0.025904581f,-0.008980484f,-0.016705468f,-0.0650012f,-0.028585697f,0.10923479f,-0.009531084f,0.07226177f,-0.015751744f,-0.0569634f,0.072144106f,-0.020176293f,0.024882268f,0.077337004f,-0.100704536f,-0.030463822f,-0.016073583f,0.03189492f,0.024718104f,0.00535341f,0.0043743136f,-0.027010033f,0.014088915f,-0.014794507f,0.028242843f,0.11176037f,-0.03238486f,0.08016061f,0.0061242515f,-0.013684403f,0.00304748f,0.027243948f,-0.04560787f,0.034038004f,0.056840252f,0.04232895f,0.0049491893f,0.006670255f,-0.035278264f,-0.08407861f,-0.06428213f,-0.004121672f,-0.022436414f,0.064734325f,0.024700103f,-0.047622852f,0.047240857f,-0.025188314f,-0.06411069f,0.066141635f,-0.066100396f,-0.037653558f,-0.07993234f,0.029930798f,-0.019337416f,-0.007640354f,0.003971166f,-0.024443032f,0.038895197f,0.038598977f,0.060647234f,0.018201817f,-0.011513723f,-0.047726464f,0.011739284f,0.02038385f,-0.01863843f,-0.0121716205f,0.0406346f,-0.02844591f,-0.023326602f,0.0397463f,-0.022273367f,0.0074657574f,0.014157242f,-0.021250967f,-0.051852066f,-0.030340606f,-0.005509147f,-0.11746068f,0.015528121f,-0.037897293f,0.049813528f,-0.024971047f,0.0064871507f,0.032726087f,0.022233063f,0.074139185f,0.04076141f,-0.014732173f,0.008179707f,0.03506244f,-0.060515776f,0.018163972f,-0.059671838f,0.01654515f,-0.015666554f,-0.017981727f,0.047716398f,0.0041694343f,-0.04481842f,0.006958289f,-0.0076244646f,0.07952198f,0.00047137268f,-0.022086246f,-0.0010023455f,0.07064799f,-0.018951403f,0.025453633f,0.00889491f,0.04680934f,-0.015712436f,-0.019722331f,-0.028648023f,-0.0136769535f,-0.032791007f,-0.022751438f,-0.004541196f,-0.059959937f,0.0006311428f,0.051897854f,0.017315006f,-0.006265934f,-0.023401577f,0.010874158f,0.04593105f,-0.047464713f,0.026298115f,-0.046319354f,0.006788574f,0.047880437f,0.08423241f,0.018548327f,0.037229754f,0.0531647f,-0.014427742f,0.00315871f,0.05445105f,-0.03847716f,0.001980926f,0.015816873f,-0.12092872f,-0.033527393f,0.020468561f,0.045792133f,0.0530266f,-0.10163443f,-0.014012209f,-0.05038387f,0.066303186f,-0.021326113f,0.0652915f,-0.004896876f,0.023939338f,0.056339025f,-0.06859314f,-0.05673742f,-0.018077947f,0.0017880622f,0.08519749f,-0.023884917f,-0.01676656f,-0.07335844f,0.025956234f}),
        ];

        float[] queryVector = [0.31377593f, 0.37188226f, 0.47027367f, 0.15416367f, -0.37782523f, 0.0040249797f, -1.7963864f, 0.3666822f, 0.9064562f, 0.2609447f, 0.17102449f, -1.7142147f, 0.4634595f, -0.8223709f, -0.6532023f, -0.1401476f, 1.4885343f, 1.2006557f, -0.99286157f, -0.7925646f, 0.64917195f, 1.0739467f, 0.2284389f, 0.94913614f, -0.5936257f, 0.4482029f, -0.28762648f, 0.21275619f, 0.4144741f, -0.32371837f, 0.065337405f, 0.59679425f, 0.29920086f, -0.19984844f, -0.62366533f, 0.21174303f, 0.10664506f, -0.71825916f, -0.32607362f, -0.91127175f, 0.26711243f, 1.009357f, -0.20104837f, -0.8970295f, 1.4117596f, -0.6571355f, -0.5363316f, 0.16924892f, -0.7498692f, -0.27932984f, 1.5055436f, -0.6788036f, -0.12481642f, -0.3978476f, 0.7255338f, 0.5384976f, 0.57337016f, -1.2248214f, -0.17388771f, -0.67840743f, -1.0752214f, -1.2246101f, -0.24839535f, 1.2287707f, 0.07035784f, -0.20802946f, -0.9832121f, 0.5415977f, -2.6001377f, -1.1490715f, 0.115911044f, 0.041276883f, -0.20488255f, -0.2401756f, 0.79341066f, 0.05578916f, -1.3807148f, 0.5168437f, 1.0812567f, -1.0299138f, -0.19297405f, 0.76548684f, 1.8999279f, -0.05895587f, -0.21840508f, -0.52891225f, 1.9815757f, -0.047751892f, 1.2815377f, 0.28640196f, 0.73117846f, -0.27563387f, -2.0804088f, 0.8373041f, 0.79637355f, -0.50760084f, -0.36045176f, 1.3176453f, 0.9720314f, 1.6038513f, -0.5412898f, 0.015928918f, 1.0674604f, 1.0878553f, 0.1241169f, -1.4479728f, -1.421983f, -0.46873397f, -0.51516f, 1.4944906f, -0.11482545f, -1.2690095f, 0.60327363f, 0.4950726f, 0.96688634f, 1.0484098f, 0.3683094f, -0.4092183f, -0.82796085f, 0.17972879f, -0.40780267f, -0.53905886f, -0.06956513f, -2.1418471f, 0.6324293f, -0.7166687f, -1.1097144f, 0.15731312f, 0.054614555f, 0.039556958f, 1.1114438f, 0.6379336f, 0.48616463f, -0.5820234f, -0.24602823f, 0.6235816f, -0.02929551f, 0.56224173f, -1.3202351f, 0.36032206f, -0.5646304f, -0.06857972f, 1.2349944f, 1.188964f, 1.3751996f, -1.9041011f, -1.1568162f, 0.23031242f, 0.28177574f, 0.80729467f, -0.7628725f, -0.42582974f, 0.9002903f, 0.06782547f, 0.15471868f, 0.16489738f, 0.7751576f, 1.175175f, 0.53334695f, 0.9051887f, -1.0257933f, -0.39980695f, -0.1658897f, 1.3812349f, 0.27497354f, -0.7575327f, -1.21952f, -0.5415579f, 0.7535864f, -0.6063876f, 0.21853356f, 0.20776947f, -0.42120743f, -0.5539597f, 0.31049848f, -0.5466897f, -1.2274243f, 0.52814394f, 2.5417109f, -0.2362915f, 0.89139634f, 0.5751277f, -0.11183765f, -0.98296607f, -0.0734149f, -0.7729809f, -0.86154556f, -0.48254737f, 0.17750263f, 0.74729717f, 0.4890566f, 1.6245937f, -1.998009f, 1.2398012f, -0.68566406f, -0.49032497f, -0.83859843f, -0.6958779f, -0.6614292f, 0.104854204f, 0.1907211f, -0.44333944f, 0.928764f, 0.794268f, -0.66201144f, -0.39981836f, 0.50572366f, -0.06910211f, -0.90422326f, 0.09630143f, -0.12443793f, 0.11014271f, -0.5363505f, -0.61392844f, -0.84193337f, 0.47851568f, -0.4610381f, 0.30792207f, 0.8091553f, -0.3416447f, 1.1701691f, 0.12035322f, 0.666025f, 0.5782747f, -0.50657505f, -1.3346962f, 0.6846461f, 0.61016667f, 0.82618445f, -1.5504749f, -0.13957898f, -1.3319235f, 0.59681165f, -0.48322052f, -1.8399254f, 1.2617925f, 0.07938786f, 0.8666193f, -0.01936639f, 0.23404846f, -0.034605213f, -1.1517856f, 2.210502f, 0.84935886f, -0.43120384f, 0.84286577f, -0.36304864f, 0.7511325f, -0.20244475f, 2.5919871f, -1.152694f, -0.7373064f, -2.2889585f, 0.52883357f, -0.7399364f, -1.0652198f, -0.46756154f, -1.2957277f, -0.44174463f, 0.54714f, 0.6835686f, 0.3474826f, -0.68240863f, 0.485775f, -0.5465015f, -0.83282435f, -0.1963373f, 0.0072188377f, -0.47070724f, -0.75901145f, 1.5970262f, -0.5507621f, 0.39436716f, -1.2580553f, 0.89213336f, 0.6923145f, -1.3498367f, -0.044910647f, 0.33968195f, 0.69761974f, -1.2052441f, -0.4035344f, -0.26660287f, 0.52847993f, 1.5746187f, 0.16431282f, -0.17009933f, -0.54671276f, -1.3866638f, 0.78171265f, 0.08947255f, 1.7772259f, -0.019755939f, 0.88282317f, 0.0729473f, 1.6737335f, 0.116997436f, 0.41406363f, 1.3434823f, -1.1742074f, -1.264308f, -0.63825184f, 0.04611094f, -0.15866058f, -0.4653769f, 0.3033535f, -1.7335904f, -0.49369842f, 1.9617993f, -1.2153114f, 3.3341205f, 0.24418958f, -0.22969043f, 0.4907778f, 0.58220816f, 0.073935926f, -0.31935048f, -0.20354632f, -0.16815342f, 0.28895003f, -1.2494295f, -0.26253086f, -0.27994442f, 0.15665285f, -2.4840887f, 0.661665f, -0.2963225f, -0.75773925f, 0.34702554f, 0.2913069f, 0.27705717f, -0.49271908f, 0.29867396f, -1.1832604f, -1.4374025f, -0.9390413f, -1.1646101f, -0.15638474f, -0.7716387f, 0.68373066f, 1.0149808f, 1.1817325f, 0.5629376f, 0.105401054f, 0.948794f, -1.1714981f, 0.15648153f, 0.23085204f, -0.10155656f, 0.4976163f, -0.2819289f, 1.390657f, 0.39947933f, 0.7837926f, -0.8511593f, -0.9734438f, -0.5168063f, -1.2350706f, 0.31996608f, 0.5859853f, -0.08916916f, 1.1461086f, -0.7474533f, -0.4817957f, -0.161196f, -0.46650392f, -0.6613833f, 0.47237834f, -0.5041076f, -1.2952859f, 0.7890894f, -1.1672986f, 0.064585336f, 0.8633636f, -0.6760055f, -0.45678204f, 0.6754199f, -1.4061843f, 0.49248332f, -1.5799578f, -1.2006445f, 0.25723422f, 1.4770243f, 0.6525689f, -0.084759906f, -0.14923234f, -0.28685507f, 0.3612631f, 0.9560286f, -0.24880779f, 0.31843632f, 1.511996f, 0.5657662f, 0.77786005f, 0.38369396f, 0.98818016f, 0.929612f, 0.24504697f, 0.4208448f, -0.1357544f, 0.6170596f, -0.060768712f, 0.35592142f, -0.104196206f, -0.8736779f, -0.061398882f, -0.5852865f, -0.5237098f, 0.2303479f, -0.32745263f, -0.034138054f, 0.5631001f, 0.1410555f, -0.672146f, -1.4554137f, -0.40655947f, 2.445832f, 0.25375882f, 1.5105493f, -0.40379873f, -1.3789451f, 1.5075628f, -0.7862397f, 0.47416696f, 1.606287f, -1.885129f, -0.5384532f, -0.6854478f, 0.52978146f, 0.34678763f, -0.029452194f, -0.03839589f, -0.3227369f, 0.08626785f, -0.5256607f, 0.54832447f, 2.1603165f, -0.783927f, 1.9631962f, 0.36152393f, -0.7767362f, -0.09990183f, 0.61548066f, -1.0368934f, 0.80852765f, 1.5078886f, 0.5438034f, 0.6091214f, -0.072978035f, -0.6406304f, -1.8894583f, -0.9674221f, -0.028764546f, -0.6923852f, 1.2954782f, 0.544843f, -0.6805662f, 0.9927999f, -0.11392969f, -1.5155036f, 1.5000933f, -2.04362f, -0.92595446f, -1.5590963f, 0.15724021f, -0.48562765f, -0.0072794557f, -0.10041626f, -0.53262687f, 0.6714905f, 0.9695152f, 1.2732723f, 0.14212824f, 0.035336643f, -0.8339755f, 0.10301139f, 0.5669173f, -0.21378894f, -0.13260524f, 0.8761226f, -0.7711915f, 0.0066919387f, 0.35969865f, -0.35002327f, 0.10507667f, 0.092384815f, -0.6699125f, -1.0792124f, -1.1486423f, -0.4471388f, -2.3478928f, 0.3393229f, -0.15393488f, 1.085235f, -0.4518629f, 0.6405399f, 0.62948143f, 0.32422993f, 1.6362635f, 0.8179361f, -0.6999462f, 0.29947305f, 0.76257575f, -1.2802494f, 0.41337594f, -1.5985575f, 0.48644105f, -0.8001906f, -0.46722308f, 0.8527094f, 0.19455901f, -0.93914574f, -0.2432797f, 0.014409622f, 1.9669338f, 0.5441672f, -0.102094375f, -0.008245558f, 1.5380014f, -0.51614195f, 0.23369363f, 0.1476014f, 0.93636763f, -0.6234264f, -0.43840942f, -0.4181757f, -0.50677854f, -0.53410476f, -0.69202816f, 0.2165711f, -0.95895374f, -0.10230535f, 0.7550109f, 0.34122586f, 0.056969352f, -0.29144156f, 0.24927755f, 0.54606915f, -0.58702546f, 0.555316f, -0.8331725f, 0.30295533f, 0.6202434f, 1.4562895f, 0.43112788f, 0.74520314f, 1.0853908f, -0.11515431f, 0.11671283f, 1.2536066f, -0.62254065f, 0.38921812f, 0.12653829f, -2.6014767f, -0.9216034f, 0.30344275f, 1.2584054f, 0.9512688f, -1.9872001f, 0.049444817f, -1.2723548f, 1.6914139f, -0.6298993f, 1.3107922f, -0.20396706f, 0.45799693f, 1.3388822f, -1.6897261f, -1.2552319f, 0.06501341f, 0.34221426f, 2.0172331f, -1.0901558f, -0.56753033f, -1.899123f, 1.115484f];

        await PrepareCollection(
            _qdrantHttpClient,
            TestCollectionName,
            distanceMetric: VectorDistanceMetric.Cosine,
            vectorSize: 576,
            upsertPoints: upsertPoints);

        var nearestPointsAllPagesResponse = (
                await _qdrantHttpClient.QueryPoints(
                    TestCollectionName,
                    new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(queryVector))
                    {
                        WithPayload = false,
                        WithVector = false,
                        Limit = 5
                    },
                    CancellationToken.None
                )
            ).EnsureSuccess();

        var nearestPointsFirstPageResponse = (
                await _qdrantHttpClient.QueryPoints(
                    TestCollectionName,
                    new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(queryVector))
                    {
                        WithPayload = false,
                        WithVector = false,
                        Limit = 4
                    },
                    CancellationToken.None
                )
            ).EnsureSuccess();

        var nearestPointsSecondPageResponse = (
                await _qdrantHttpClient.QueryPoints(
                    TestCollectionName,
                    new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(queryVector))
                    {
                        WithPayload = false,
                        WithVector = false,
                        Limit = 4,
                        Offset = 1
                    },
                    CancellationToken.None
                )
            ).EnsureSuccess();

        var allPagesPointIds = nearestPointsAllPagesResponse.Points
           .Select(p => p.Id)
           .ToList();

        var firstPagePointIds = nearestPointsFirstPageResponse.Points
            .Select(p => p.Id)
            .ToList();

        var secondPagePointIds = nearestPointsSecondPageResponse.Points
            .Select(p => p.Id)
            .ToList();

        allPagesPointIds.Should().Contain(firstPagePointIds);
        allPagesPointIds.Should().Contain(secondPagePointIds);

        secondPagePointIds.Should().NotBeInAscendingOrder(); // Since all points on the second page have the same score - the order is not guaranteed

        // Since the scores are identical the actual order is not guaranteed
        allPagesPointIds.Should().NotContainInOrder(firstPagePointIds);

        // Since we have skipped the only point with different score, the order should be the same
        allPagesPointIds.Should().ContainInOrder(secondPagePointIds);
    }

    [Test]
    public async Task FindNearestPoints_WithPrefetch()
    {
        var (_, upsertPointsByPointIds, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName);

        var nearestPointsResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(upsertPointsByPointIds.First().Value.Id))
            {
                Prefetch =
                [
                    new PrefetchPoints()
                    {
                        Filter = Q<TestPayload>.BeInRange(
                            p => p.Integer,
                            greaterThanOrEqual: 0,
                            lessThanOrEqual: 2)
                    }
                ],
                WithPayload = true,
                WithVector = true,
                Limit = 10
            },
            CancellationToken.None);

        nearestPointsResponse.Status.IsSuccess.Should().BeTrue();
        // less than limit since prefetch should eliminate all points but 3
        nearestPointsResponse.Result.Points.Length.Should().Be(2);

        nearestPointsResponse.Result.Points.Should()
            .AllSatisfy(
                p =>
                    p.Payload.As<TestPayload>().Integer.Should().BeInRange(0, 2)
            ).And.AllSatisfy(
                p =>
                    p.Score.Should().BeGreaterThan(0)
            );
    }

    [Test]
    public async Task FindNearestPoints_WithOrderByViaPrefetch()
    {
        var (_, upsertPointsByPointIds, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName);

        // order by does not work without indexes
        await _qdrantHttpClient.CreatePayloadIndex(
            TestCollectionName,
            "integer",
            PayloadIndexedFieldType.Integer,
            CancellationToken.None,
            isWaitForResult: true);

        await _qdrantHttpClient.EnsureCollectionReady(TestCollectionName, CancellationToken.None);

        var nearestPointsResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(PointsQuery.CreateOrderByQuery(OrderBySelector.Asc("integer")))
            {
                Prefetch =
                [
                    new PrefetchPoints()
                    {
                        Filter = Q<TestPayload>.BeInRange(
                            p => p.Integer,
                            greaterThanOrEqual: 0,
                            lessThanOrEqual: 2),
                        Query = PointsQuery.CreateFindNearestPointsQuery(upsertPointsByPointIds.First().Value.Vector),
                    }
                ],
                WithPayload = true,
                WithVector = true,
                Limit = 10
            },
            CancellationToken.None);

        nearestPointsResponse.Status.IsSuccess.Should().BeTrue();
        // less than limit since prefetch should eliminate all points but 3
        nearestPointsResponse.Result.Points.Length.Should().Be(3);

        nearestPointsResponse.Result.Points.Should()
            .AllSatisfy(
                p =>
                    p.Payload.As<TestPayload>().Integer.Should().BeInRange(0, 2)
            ).And.AllSatisfy(
                p =>
                {
                    if (IsVersionBefore("1.16.0"))
                    {
                        // Since we are ordering by as the final stage of the multi-stage query we don't get any scores
                        p.Score.Should().Be(0);
                    }
                    else
                    {
                        p.Score.Should().Be(1);
                    }
                }
            );
    }

    [Test]
    public async Task FindNearestPoints_WithAcorn()
    {
        OnlyIfVersionAfterOrEqual("1.16.0", "ACORN algorithm is available only from v1.16");

        var (_, upsertPointsByPointIds, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName);

        var queryPointsResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(upsertPointsByPointIds.First().Value.Vector))
            {
                WithPayload = true,
                WithVector = true,
                Limit = 2,

                Params = new()
                {
                    Acorn = new()
                    {
                        Enable = true,
                        MaxSelectivity = 1.0 // 1.0 means ACORN will always be used
                    }
                }
            },
            CancellationToken.None
        );

        queryPointsResponse.Status.IsSuccess.Should().BeTrue();
        queryPointsResponse.Result.Points.Length.Should().Be(2);
        queryPointsResponse.Result.Points.Should().AllSatisfy(
            p => p.Score.Should().BeGreaterThan(0)
        );

        if (!IsCiEnvironment)
        {
            // CI environment container does not have usage statistics enabled

            queryPointsResponse.Usage.Cpu.Should().BeGreaterThan(0);
            queryPointsResponse.Usage.PayloadIoRead.Should().BeGreaterThan(0);
            queryPointsResponse.Usage.VectorIoRead.Should().BeGreaterThan(0);
        }
        else
        {
            queryPointsResponse.Usage.Should().BeNull();
        }
    }

    [Test]
    [TestCase(FusionAlgorithm.Rrf)]
    [TestCase(FusionAlgorithm.Dbsf)]
    public async Task Fusion(FusionAlgorithm fusionAlgorithm)
    {
        var (_, upsertPointsByPointIds, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName);

        var nearestPointsResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(PointsQuery.CreateFusionQuery(fusionAlgorithm))
            {
                Prefetch =
                [
                    new PrefetchPoints()
                    {
                        Filter = Q<TestPayload>.BeInRange(
                            p => p.Integer,
                            greaterThanOrEqual: 0,
                            lessThanOrEqual: 2),
                        Limit = 10
                    },
                    new PrefetchPoints()
                    {
                        Query = PointsQuery.CreateFindNearestPointsQuery(upsertPointsByPointIds.First().Value.Id),
                        Limit = 5
                    }
                ],
                WithPayload = true,
                WithVector = true
            },
            CancellationToken.None);

        nearestPointsResponse.Status.IsSuccess.Should().BeTrue();
        // first prefetch returns 3 points
        // second prefetch returns up to 5 points
        nearestPointsResponse.Result.Points.Length.Should().BeInRange(5, 8);

        nearestPointsResponse.Result.Points.Should().AllSatisfy(
            p => p.Score.Should().BeGreaterThan(0)
        );
    }

    [Test]
    public async Task Sample()
    {
        await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName);

        var sampleRandomPointsResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(PointsQuery.CreateSampleQuery())
            {
                WithPayload = true,
                WithVector = true,
                Limit = 3
            },
            CancellationToken.None);

        sampleRandomPointsResponse.Status.IsSuccess.Should().BeTrue();
        sampleRandomPointsResponse.Result.Points.Length.Should().Be(3);

        if (IsVersionBefore("1.16.0"))
        {
            sampleRandomPointsResponse.Result.Points.Should().AllSatisfy(
                // Since we are not using query vector we don't get any scores
                p => p.Score.Should().Be(0)
            );
        }
        else
        {
            // Score is set to 1 for sample query starting from Qdrant 1.16.0
            sampleRandomPointsResponse.Result.Points.Should().AllSatisfy(
                // Since we are not using query vector we don't get any scores
                p => p.Score.Should().Be(1)
            );
        }
    }

    [Test]
    public async Task OrderByPoints()
    {
        await PrepareCollection(
            _qdrantHttpClient,
            TestCollectionName);

        // order by does not work without indexes
        await _qdrantHttpClient.CreatePayloadIndex(
            TestCollectionName,
            "integer",
            PayloadIndexedFieldType.Integer,
            CancellationToken.None,
            isWaitForResult: true);

        await _qdrantHttpClient.EnsureCollectionReady(TestCollectionName, CancellationToken.None);

        var orderedPointsResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(PointsQuery.CreateOrderByQuery(OrderBySelector<TestPayload>.Asc(p => p.Integer)))
            {
                Prefetch =
                [
                    new PrefetchPoints()
                    {
                        Query = PointsQuery.CreateOrderByQuery(
                            OrderBySelector<TestPayload>.Desc(p => p.Integer)),
                        Limit = 2
                    }
                ],
                WithPayload = true,
                WithVector = true
            },
            CancellationToken.None);

        orderedPointsResponse.Status.IsSuccess.Should().BeTrue();
        orderedPointsResponse.Result.Points.Length.Should().Be(2);

        var orderedPoints = orderedPointsResponse.Result.Points.OrderBy(p => p.Score).ToList();

        var firstPoint = orderedPoints.First();
        var secondPoint = orderedPoints.Skip(1).First();

        if (IsVersionBefore("1.16.0"))
        {
            // Since we are not using the query vector we don't get any scores
            firstPoint.Score.Should().Be(0);
            secondPoint.Score.Should().Be(0);
        }
        else
        {
            // Since we are not using the query vector we don't get any scores
            firstPoint.Score.Should().Be(1);
            secondPoint.Score.Should().Be(1);
        }

        firstPoint.Payload.As<TestPayload>().Integer!.Value
            .Should().BeLessThan(secondPoint.Payload.As<TestPayload>().Integer!.Value);
    }

    [Test]
    public async Task QueryPointsBatched()
    {
        var (_, upsertPointsByPointIds, upsertPointIds) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName);

        var queryResponse = await _qdrantHttpClient.QueryPointsBatched(
            TestCollectionName,
            new QueryPointsBatchedRequest(
                new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(upsertPointIds[0]))
                {
                    Filter =
                        Q.Must(
                            Q<TestPayload>.BeInRange(p => p.Integer, greaterThanOrEqual: 0)
                        ),
                    WithPayload = true,
                    WithVector = true,
                    Limit = 5
                },
                new QueryPointsRequest(PointsQuery.CreateFindNearestPointsQuery(upsertPointIds[1]))
                {
                    Filter =
                        Q.Must(
                            Q<TestPayload>.BeInRange(p => p.Integer, greaterThanOrEqual: 0)
                        ),
                    WithPayload = true,
                    WithVector = true,
                    Limit = 5
                }
            ),
            CancellationToken.None);

        queryResponse.Status.IsSuccess.Should().BeTrue();
        queryResponse.Result.Length.Should().Be(2);

        foreach (var readPointsForOneRequestInBatch in queryResponse.Result)
        {
            readPointsForOneRequestInBatch.Points.Length.Should().Be(5);

            foreach (var readPoint in readPointsForOneRequestInBatch.Points)
            {
                var readPointId = readPoint.Id.AsInteger();

                var expectedPoint = upsertPointsByPointIds[readPointId];

                expectedPoint.Id.AsInteger().Should().Be(readPointId);

                var readPointPayload = readPoint.Payload.As<TestPayload>();

                var expectedPointPayload = expectedPoint.Payload.As<TestPayload>();

                readPointPayload.Integer.Should().Be(expectedPointPayload.Integer);
                readPointPayload.FloatingPointNumber.Should()
                    .Be(expectedPointPayload.FloatingPointNumber);
                readPointPayload.Text.Should().Be(expectedPointPayload.Text);

                readPoint.Score.Should().BeGreaterThan(0);
            }
        }
    }

    [Test]
    public async Task QueryPointsGrouped()
    {
        var vectorCount = 10;

        var (upsertPoints, _, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName,
                vectorCount: vectorCount,
                payloadInitializerFunction: i => new TestPayload()
                {
                    Integer = i < 5
                        ? 1
                        : 2,
                    Text = (i + 1).ToString()
                });

        var queryResponse = await _qdrantHttpClient.QueryPointsGrouped(
            TestCollectionName,
            new QueryPointsGroupedRequest(
                PointsQuery.CreateFindNearestPointsQuery(upsertPoints[0].Vector),
                groupBy: Q<TestPayload>.GetPayloadFieldName(p => p.Integer),
                groupsLimit: 2,
                groupSize: 10,
                withVector: true,
                withPayload: true),
            CancellationToken.None);

        queryResponse.Status.IsSuccess.Should().BeTrue();
        queryResponse.Result.Groups.Length.Should().Be(2); // 2 possible values of Integer payload property

        queryResponse.Result.Groups.Should()
            .AllSatisfy(g => g.Hits.Length.Should().Be(vectorCount / 2))
            .And.AllSatisfy(
                g => g.Hits.Should()
                    .AllSatisfy(h => h.Payload.Should().NotBeNull())
                    .And.AllSatisfy(h => h.Vector.Should().NotBeNull())
                    .And.AllSatisfy(h => h.Score.Should().BeGreaterThan(0))
            );
    }

    [Test]
    public async Task QueryPoints_ScoreBoosting_Constant()
    {
        var vectorCount = 10;

        var (upsertPoints, _, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName,
                vectorCount: vectorCount,
                payloadInitializerFunction: i => new TestPayload()
                {
                    Integer = i < 5
                        ? 1
                        : 2,
                    Text = (i + 1).ToString()
                });

        var queryResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(
                PointsQuery.CreateFormulaQuery(F.Constant(10)), // All resulting points will have score 10
                withVector: true,
                withPayload: true)
            {
                Prefetch =
                [
                    new PrefetchPoints()
                    {
                        Query = PointsQuery.CreateFindNearestPointsQuery(upsertPoints[0].Vector),
                        Limit = 2
                    }
                ]
            },
            CancellationToken.None);

        queryResponse.Status.IsSuccess.Should().BeTrue();

        queryResponse.Result.Points.Should().AllSatisfy(p => p.Score.Should().Be(10));
    }

    [Test]
    public async Task QueryPoints_ScoreBoosting_PayloadFieldBased()
    {
        var vectorCount = 10;

        var (upsertPoints, _, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName,
                vectorCount: vectorCount,
                payloadInitializerFunction: i => new TestPayload()
                {
                    Integer = i,
                    Text = (i + 1).ToString()
                });

        var queryResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(
                PointsQuery.CreateFormulaQuery(
                    F.Sum(
                        1,
                        F.Filter(
                            Q.BeInRange(
                                "integer",
                                greaterThanOrEqual: 5,
                                lessThanOrEqual: 7)
                        )
                    )
                ),
                withVector: true,
                withPayload: true)
            {
                Prefetch =
                [
                    new PrefetchPoints()
                    {
                        Query = PointsQuery.CreateFindNearestPointsQuery(upsertPoints[0].Vector),
                        Limit = 10
                    }
                ]
            },
            CancellationToken.None);

        queryResponse.Status.IsSuccess.Should().BeTrue();

        foreach (var readPoint in queryResponse.Result.Points)
        {
            var readPointInteger = readPoint.Payload.As<TestPayload>().Integer;

            // Points with Integer payload field value in range [5, 7] will have score 2
            // All other points will have score 1

            readPoint.Score.Should().Be(
                readPointInteger is >= 5 and <= 7
                    ? 2
                    : 1
            );
        }
    }

    [Test]
    public async Task QueryPoints_Mmr()
    {
        OnlyIfVersionAfterOrEqual("1.15.0", "MMR query parameters is supported starting from Qdrant 1.15.0");

        var vectorCount = 10;

        var (upsertPoints, _, _) =
            await PrepareCollection(
                _qdrantHttpClient,
                TestCollectionName,
                vectorCount: vectorCount,
                payloadInitializerFunction: i => new TestPayload()
                {
                    Integer = i,
                    Text = (i + 1).ToString()
                });

        var nearestPointsResponse = await _qdrantHttpClient.QueryPoints(
            TestCollectionName,
            new QueryPointsRequest(
                PointsQuery.CreateFindNearestPointsQuery(
                    upsertPoints[0].Vector,
                    mmrDiversity: 0.3,
                    mmrCandidatesLimit: 3
                )
            )
            {
                WithPayload = true,
                WithVector = true,
                Limit = 5 // This value gets overridden by MMR limit
            },
            CancellationToken.None);

        nearestPointsResponse.Status.IsSuccess.Should().BeTrue();
        nearestPointsResponse.Result.Points.Length.Should().Be(3); // Using mmr limit 3 therefore we get only 3 points
    }
}
