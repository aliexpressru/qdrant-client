using Aer.QdrantClient.Http;
using Aer.QdrantClient.Http.Models.Primitives;
using Aer.QdrantClient.Http.Models.Primitives.Vectors;
using Aer.QdrantClient.Http.Models.Requests.Public;
using Aer.QdrantClient.Http.Models.Shared;
using Aer.QdrantClient.Tests.Base;
using Aer.QdrantClient.Tests.Helpers;

namespace Aer.QdrantClient.Tests.TestClasses.HttpClientTests;

// NOTE: this is an ad-hoc mess used to troubleshoot various problems
#pragma warning disable IDE0059 // Unnecessary assignment of a value | Justification - this is a meesy test file

[Ignore("Real world tests are run locally only and are enabled manually")]
internal class RealWorldTests : QdrantTestsBase
{
    private QdrantHttpClient _qdrantHttpClient;

    [OneTimeSetUp]
    public void Setup()
    {
        //_qdrantHttpClient = new QdrantHttpClient(httpAddress: new Uri("xxxx"), apiKey: "xxxx");

        Initialize();
        _qdrantHttpClient = ServiceProvider.GetRequiredService<QdrantHttpClient>();
    }

    [SetUp]
    public async Task BeforeEachTest()
    {
        await ResetStorage(_qdrantHttpClient);
    }

    [Test]
    public async Task Insert_Sparse_Duplicates()
    {
        var sparseVectorsConfiguration = new Dictionary<string, SparseVectorConfiguration>()
        {
            [VectorBase.DefaultVectorName] = new()
            {
                Modifier = SparseVectorModifier.None,
                Index = new()
                {
                    OnDisk = true,
                    FullScanThreshold = 5000,
                    Datatype = VectorDataType.Float32
                }
            }
        };

        var collectionCreationResult = await _qdrantHttpClient.CreateCollection(
            TestCollectionName,
            new CreateCollectionRequest(sparseVectorsConfiguration: sparseVectorsConfiguration)
            {
                OnDiskPayload = true
            },
            CancellationToken.None);

        collectionCreationResult.EnsureSuccess();

        // Test points
        // The strange conversion to double and then to float via extension is here
        // to allow creating test points by simply copying JSON arrays
        List<(uint[] Indices, float[] Values)> pointsToUpsert = new(30) {

            (
            [
            22873636,
            22747375,
            8493721,
            8446733,
            21276886,
            21159433,
            38946184,
            39162694,
            23018100,
            22891016,
            27040378,
            27190493,
            19740206,
            19849752,
            5091449,
            5063230,
            45306281,
            45558103,
            21489833,
            21371187,
            32302144,
            32123843,
            22595159,
            22470418
                ]
                ,
                ((double[])
                [
            224.2396,
            224.2396,
            248.28435,
            248.28435,
            246.4564,
            246.4564,
            248.28041,
            248.28041,
            63.18493,
            63.18493,
            62.819267,
            62.819267,
            61.34924,
            61.34924,
            248.27072,
            248.27072,
            333.40366,
            333.40366,
            66.9877,
            66.9877,
            342.58508,
            342.58508,
            248.24226,
            248.24226
        ]
                ).ToFloat()
            ),
            (
            [
            38428316,
            38215898,
            15453285,
            15538974,
            17474550,
            27114267,
            26964578,
            15031610,
            14948728,
            44623784,
            44377131,
            43393522,
            43153829,
            3380717,
            3399657,
            45529311,
            45277647,
            3583591,
            3563600,
            36359742,
            36561593,
            7007866,
            6969008,
            26363297,
            26217803,
            6453417,
            6489367,
            14644568,
            14725689,
            18642554,
            18539705,
            44971805,
            45221787,
            6614968,
            6651801,
            14819812,
            14901968,
            34442901,
            34252838,
            6720588,
            6758014,
            3179533,
            3197323,
            5752554,
            5720605,
            3869650,
            3891306,
            7297465,
            7338175,
            37354888,
            37562325,
            41576501,
            6996183,
            7035197,
            42506554,
            42742723,
            1992384,
            1981397,
            15804260,
            15891874,
            19902200,
            20012669,
            6604061,
            6640829,
            11810031,
            11875598,
            4080758,
            39472324,
            39254102,
            43223965,
            43464062,
            23466315,
            23336757,
            29052975,
            28892622,
            20906243,
            21022293,
            31073641,
            31246195,
            23648998,
            23780315,
            23653293,
            23522687,
            22180054,
            22303188,
            12492803,
            12562108,
            2739240,
            2754537,
            18034823,
            18134841,
            34568631,
            34760427,
            7800916,
            7757735,
            26450159,
            14854619,
            14936958,
            28888784,
            29049120,
            22348593,
            3457412,
            3438154,
            14257641,
            14178976,
            8881981,
            8931342,
            33019925,
            33203130,
            45848293,
            46103147,
            22838307,
            22965071,
            41429433,
            41659602,
            30308179,
            30476472,
            18111084,
            18011192,
            33942154,
            34130531,
            14395904,
            14475686,
            36191711,
            35991950,
            2649837,
            2635126,
            4620824,
            4646551,
            32524270,
            32704782,
            10050357,
            10106245,
            14434904,
            14514889,
            33974251,
            34162816,
            28266631,
            28110542,
            39218685,
            39436674,
            25294701,
            25435174,
            41495999,
            41726519,
            26419695,
            26566290,
            20442262,
            20329446,
            36629210,
            36426971,
            30252177,
            30085121,
            17705031,
            17607430,
            27701817,
            27855603,
            42664908,
            42902015,
            25759293,
            25902326,
            12801311,
            44747350,
            5251098,
            5280388,
            14497133,
            14577471,
            9974167,
            9919007,
            6822691,
            6860724,
            2657985,
            42000918,
            42234287,
            21851268,
            21730591,
            34404358,
            34595255,
            16668734,
            16576855,
            26825271,
            26677223,
            21519831,
            21401016,
            22426999,
            22303206,
            8734631,
            8686346,
            33103536,
            33287232,
            19479776,
            19587873,
            23883417,
            24016000,
            37591564,
            37383958,
            9530114,
            9583070,
            9311281,
            9259867,
            37323794,
            37531048
        ]
                ,
                ((double[])
                [
            3.5584166,
            3.5584166,
            23.327152,
            23.327152,
            469.73883,
            14.477617,
            14.477617,
            449.9464,
            449.9464,
            75.81481,
            75.81481,
            356.5525,
            356.5525,
            3.555012,
            3.555012,
            7.246771,
            7.246771,
            3.558343,
            3.558343,
            3.5574708,
            3.5574708,
            9.862411,
            9.862411,
            119.21615,
            119.21615,
            13.683981,
            13.683981,
            8.379244,
            8.379244,
            70.71782,
            70.71782,
            66.15059,
            66.15059,
            3.4054086,
            3.4054086,
            438.37228,
            438.37228,
            390.01404,
            390.01404,
            14.47444,
            14.47444,
            531.22784,
            531.22784,
            75.78883,
            75.78883,
            3.5606391,
            3.5606391,
            74.24979,
            74.24979,
            75.81888,
            75.81888,
            469.73483,
            423.87677,
            423.87677,
            322.54855,
            322.54855,
            71.128395,
            71.128395,
            3.4070868,
            3.4070868,
            429.63016,
            429.63016,
            206.9362,
            206.9362,
            13.420858,
            13.420858,
            469.7583,
            14.041985,
            14.041985,
            3.3200808,
            3.3200808,
            3.4099922,
            3.4099922,
            256.68106,
            256.68106,
            3.555324,
            3.555324,
            59.44101,
            59.44101,
            72.510544,
            72.510544,
            3.3174744,
            3.3174744,
            82.71978,
            82.71978,
            67.99449,
            67.99449,
            449.93326,
            449.93326,
            8.347078,
            8.347078,
            623.77936,
            623.77936,
            423.85144,
            423.85144,
            469.24072,
            449.96945,
            449.96945,
            31.398066,
            31.398066,
            469.67984,
            82.72059,
            82.72059,
            3.561004,
            3.561004,
            3.5552287,
            3.5552287,
            75.76804,
            75.76804,
            14.651126,
            14.651126,
            72.6853,
            72.6853,
            75.638985,
            75.638985,
            3.5598664,
            3.5598664,
            75.78569,
            75.78569,
            14.650965,
            14.650965,
            3.5573754,
            3.5573754,
            3.5584471,
            3.5584471,
            3.5616467,
            3.5616467,
            3.4057865,
            3.4057865,
            29.521124,
            29.521124,
            3.4103832,
            3.4103832,
            54.341255,
            54.341255,
            469.76462,
            469.76462,
            3.406692,
            3.406692,
            449.96124,
            449.96124,
            438.41238,
            438.41238,
            68.655914,
            68.655914,
            3.3232443,
            3.3232443,
            382.0581,
            382.0581,
            64.76751,
            64.76751,
            3.5602136,
            3.5602136,
            3.557332,
            3.557332,
            14.107475,
            14.107475,
            3.4119306,
            3.4119306,
            7.439387,
            7.439387,
            469.6552,
            469.66037,
            3.5603569,
            3.5603569,
            3.3242373,
            3.3242373,
            413.65005,
            413.65005,
            743.2618,
            743.2618,
            469.67352,
            3.5589852,
            3.5589852,
            14.651715,
            14.651715,
            56.192974,
            56.192974,
            65.16534,
            65.16534,
            72.455826,
            72.455826,
            83.57717,
            83.57717,
            69.501274,
            69.501274,
            75.82803,
            75.82803,
            72.523895,
            72.523895,
            79.778824,
            79.778824,
            430.1948,
            430.1948,
            3.561612,
            3.561612,
            14.043406,
            14.043406,
            177.46172,
            177.46172,
            75.8088,
            75.8088
        ]
                ).ToFloat()
            ),
            (
            [
            16412488,
            4727134,
            10773948,
            16271546,
            35630669,
            15749585,
            40847572,
            41135546,
            6695393,
            13605663,
            46200557,
            36069505,
            23672021,
            2599847,
            28660372
        ]
                ,
                ((double[])
                [
            146.23904,
            182.95631,
            11.413927,
            242.48228,
            216.71646,
            0.9557205,
            149.81393,
            1.360337,
            2.8659596,
            242.4412,
            1.0234941,
            2.256072,
            256.05975,
            3.5845735,
            13.710515
        ]
                ).ToFloat()
            ),
            (
            [
            3623560,
            42510532,
            2450475,
            43351517,
            2945564,
            2388710,
            24131038,
            46509176
        ]
                ,
                ((double[])
                [
            0.48132136,
            25.171967,
            0.4816155,
            10.649361,
            0.480879,
            0.4610109,
            10.199849,
            19.27808
        ]
                ).ToFloat()
            ),
            (
            [
            39542634,
            39324044,
            21905253,
            22026859,
            4536102,
            4561391,
            8346261,
            8392697,
            15612321,
            15698899,
            36043559,
            36243627,
            2055166,
            2066586
        ]
                ,
                ((double[])
                [
            254.16612,
            254.16612,
            224.09756,
            224.09756,
            237.12492,
            237.12492,
            327.95505,
            327.95505,
            254.07533,
            254.07533,
            243.43132,
            243.43132,
            316.2268,
            316.2268
        ]
                ).ToFloat()
            ),
            (
            [
            41382992,
            22693561
        ]
                ,
                ((double[])
                [
            37.04187,
            144.25586
        ]
                ).ToFloat()
            ),
            (
            [
            21408273,
            35505435,
            11164801,
            4883948,
            46120404,
            2382567,
            3655667,
            34425085,
            28623155,
            8430821,
            24586043,
            42845262,
            25386015,
            5039111,
            20933556,
            36520047
        ]
                ,
                ((double[])
                [
            301.42526,
            161.42563,
            33.593147,
            9.9005,
            9.724395,
            70.279396,
            81.575874,
            176.30513,
            176.33372,
            314.67657,
            87.88932,
            314.7165,
            33.59237,
            33.58811,
            32.173214,
            87.42476
        ]
                ).ToFloat()
            ),
            (
            [
            41628770
        ]
                ,
                ((double[])
[
            561.79004
        ]
                ).ToFloat()
            ),
            (
            [
            41213518,
            18940132,
            14720008,
            24148613,
            14936946,
            24756444,
            20901051,
            29442410,
            37576072,
            33316720,
            19960651,
            27692880
        ]
                ,
                ((double[])
                [
            528.7596,
            528.7293,
            12.543712,
            443.37283,
            4.9619966,
            510.8581,
            528.6571,
            14.225974,
            1019.06866,
            527.56934,
            466.0009,
            505.29562
        ]
                ).ToFloat()
            ),
            (
            [
            44901419,
            20719455,
            37440865,
            5025081,
            7321741,
            1184481,
            44290319,
            17536449,
            34109527,
            5991157,
            43063414,
            25244982,
            1911138,
            30083704,
            16023858,
            32736856,
            43738240,
            10624269,
            14554446,
            29006408,
            18486228,
            1929246,
            15143638,
            11944216,
            39247317,
            11002716,
            10758514,
            32031423,
            6764717,
            37347205,
            16962462,
            34861603,
            10826806,
            13681882,
            13673461,
            468912,
            43902933,
            22248670,
            8787283,
            1812735,
            12926515,
            24593935,
            13133075,
            27195011,
            37009617,
            24552806,
            9286268,
            41613053,
            39527828,
            28712879,
            23714126,
            13404312,
            26507758,
            4439475,
            31958537,
            62867,
            23779455,
            36366526,
            41793626,
            30032649,
            5724494,
            37488129,
            42414795,
            19601017,
            16913922,
            44324467,
            21090635,
            31477900,
            12251461,
            23284354,
            28373053,
            29446246,
            10722628,
            32601276,
            40277416,
            38697026,
            34513856,
            6548023,
            12673893,
            6902566,
            41628757,
            31739474,
            6352701,
            25611989,
            43670591,
            12468426,
            36665701,
            38630517,
            46450364,
            28110313,
            4136103,
            4438118,
            44037450,
            25005752,
            2910893,
            946775,
            38851455,
            45304389,
            20156339,
            21301582,
            7459174,
            39605751,
            712361,
            5922703,
            42992669,
            23411004,
            3052032,
            14929715,
            37932100,
            37276059,
            17687864,
            2745488,
            40864600,
            18434098,
            12522011,
            45626338,
            25854470,
            27562492,
            29698746,
            46313791,
            38322538,
            2821352,
            30738363,
            41754534,
            6936223,
            33027664,
            45840933,
            34960135,
            13574462,
            17588956,
            20559140,
            15838404,
            40929956,
            3786755,
            18930660,
            408809,
            35889573,
            6564000,
            23554196,
            35293937,
            15701078,
            38141227,
            39689023,
            32548397,
            38091497,
            25869043,
            8527,
            37122154,
            23771886,
            10930896,
            36130141,
            12900222,
            7025388,
            8366470,
            34224241,
            37935105,
            7515133,
            21253159,
            25279834,
            25337327,
            15685328,
            20713106,
            17660905,
            46398577,
            14069982,
            21312463,
            22609730,
            20733801,
            24261699,
            45099799,
            16155487,
            40167264,
            27062253,
            3187916,
            25572508,
            41768806,
            7766406,
            4135933,
            21727233,
            23005299,
            36335764,
            7151956,
            39465203,
            15492482,
            27735052,
            32461151,
            44229249,
            42307368,
            12664651,
            43374505,
            21390059,
            24226768,
            30601607,
            35620861,
            15531345
        ]
                ,
                ((double[])
                [
            67.52696,
            3.3062563,
            35.864185,
            15.948328,
            591.3988,
            380.04587,
            2182.52,
            420.56546,
            367.07208,
            54.398617,
            636.5232,
            269.56366,
            310.33496,
            335.26315,
            324.05588,
            1029.0283,
            589.3035,
            339.5035,
            9.755879,
            1297.6686,
            511.65677,
            184.89636,
            86.28228,
            1.7881854,
            356.65546,
            406.26804,
            193.66142,
            0.11680155,
            784.87524,
            0.11188908,
            331.42944,
            177.09682,
            3.7493622,
            271.3243,
            343.15613,
            374.07074,
            435.3858,
            123.039604,
            477.0812,
            417.0869,
            311.9619,
            456.44943,
            28.389023,
            667.3034,
            1.3527188,
            285.97214,
            625.2494,
            331.53574,
            276.295,
            0.9959051,
            3.750734,
            307.1602,
            754.5045,
            253.99194,
            424.3551,
            8.771922,
            349.94385,
            355.02493,
            3.9159446,
            624.40875,
            78.7313,
            343.67834,
            4.614201,
            87.07935,
            1087.559,
            262.5586,
            0.07971249,
            363.65878,
            435.29926,
            315.78085,
            285.68008,
            294.46457,
            1.8669823,
            190.02002,
            420.49033,
            331.244,
            935.6314,
            4.99688,
            314.00153,
            523.2971,
            957.6679,
            7575.8877,
            911.37274,
            3.4517455,
            541.58014,
            701.55164,
            38.088116,
            354.45694,
            392.80023,
            593.7419,
            3.7283523,
            0.111876525,
            727.16815,
            306.82413,
            8.692217,
            835.54877,
            415.98865,
            63.132626,
            389.4667,
            193.54016,
            9.10337,
            375.5605,
            17.112984,
            1819.2451,
            1.0169213,
            1091.2279,
            22.610306,
            0.28624883,
            674.8895,
            248.68578,
            2.64032,
            127.083626,
            180.68082,
            15.428898,
            4.5105767,
            487.41733,
            398.836,
            1127.315,
            567.7056,
            582.3183,
            416.73053,
            613.5354,
            373.0109,
            265.8362,
            300.74197,
            1331.5356,
            331.19995,
            1295.3137,
            66.38278,
            3.7518184,
            350.4182,
            632.28143,
            252.79271,
            228.1889,
            374.56964,
            499.2563,
            319.7481,
            621.04144,
            78.36478,
            420.34753,
            66.36376,
            355.2611,
            982.4336,
            262.6201,
            45.60651,
            105.34577,
            747.1909,
            646.2491,
            387.94946,
            642.1711,
            27.20269,
            341.235,
            536.3104,
            9.344731,
            420.72653,
            9.414905,
            256.86823,
            118.1029,
            579.1191,
            23.373743,
            252.7699,
            323.72418,
            551.72516,
            87.920296,
            52.633648,
            243.50514,
            416.94095,
            343.19064,
            875.2039,
            198.69824,
            928.31866,
            345.69736,
            331.51837,
            336.66968,
            9.179361,
            792.13934,
            0.116849855,
            0.31986913,
            605.1814,
            67.38203,
            339.5938,
            623.44073,
            54.950554,
            133.75006,
            1187.9796,
            61.043736,
            655.37744,
            284.88815,
            184.89839,
            348.16522,
            386.16815,
            367.22614,
            489.14575,
            685.7785,
            47.71233
        ]
                ).ToFloat()
            ),
            (
            [
            23190390,
            528888,
            28687357,
            2751930,
            12218848,
            12848988,
            7732155,
            35479232,
            31729957,
            46219831,
            14188106,
            7246148,
            5085911,
            39722408,
            33655758,
            39375359,
            24739546,
            35596632,
            6432862,
            21783455,
            12688231,
            32119016,
            2353237,
            5332259,
            12511812,
            11083911,
            4333394,
            18728562,
            11077171,
            2052546,
            4464493,
            37022843,
            16249712,
            28404287,
            23024848,
            19726207,
            46146987,
            37549496,
            7208358,
            28556849,
            40733529,
            4962013,
            28658054,
            24665068,
            10496327,
            35060015,
            37749753,
            11484088,
            549949,
            43852051,
            22808006,
            36942201,
            37307917,
            37736124,
            6820602,
            18692356,
            11672356,
            15303865,
            1146859,
            29210454,
            6024569,
            9147691,
            35463881,
            37161304,
            41134311,
            35047756,
            20425603,
            45695059,
            29480049,
            33767290,
            6280149,
            25993720
        ]
                ,
                ((double[])
                [
            236.72153,
            217.59326,
            25.56107,
            487.26526,
            487.2534,
            288.7728,
            241.36937,
            425.326,
            425.43597,
            241.22401,
            111.81511,
            157.73051,
            487.85568,
            454.30048,
            487.61835,
            339.57742,
            466.80927,
            487.78903,
            386.17053,
            277.52142,
            494.53168,
            439.8654,
            208.55022,
            217.88315,
            355.19955,
            441.34134,
            417.54398,
            206.40224,
            454.92694,
            269.5725,
            577.9557,
            241.38733,
            753.0492,
            229.56079,
            295.86545,
            243.64081,
            487.42514,
            468.76245,
            230.68832,
            603.0211,
            199.1029,
            421.1038,
            343.68906,
            146.75656,
            104.75731,
            231.14702,
            226.29672,
            466.25742,
            434.7899,
            104.53437,
            723.4094,
            196.27457,
            301.7289,
            157.76205,
            425.7131,
            446.3661,
            446.23547,
            324.39554,
            454.85983,
            487.50064,
            52.1169,
            29.125273,
            241.39851,
            329.22083,
            47.98465,
            93.735405,
            227.34262,
            218.57439,
            1252.2527,
            990.47736,
            320.67957,
            105.25221
        ]
                ).ToFloat()
            ),
            (
            [
            42227288,
            23302865,
            11415061,
            15859217,
            21298756,
            21079710,
            11556393,
            24364366,
            8009148,
            1350654,
            28974638,
            39047728,
            12160862,
            26340935,
            8912582,
            22096931
        ]
                ,
                ((double[])
                [
            399.67593,
            46.80062,
            376.3464,
            205.03838,
            367.096,
            433.61285,
            670.5769,
            378.708,
            400.3188,
            380.10657,
            366.422,
            397.9863,
            40.48747,
            377.67886,
            309.14313,
            415.51566
        ]
                ).ToFloat()
            ),
            (
            [
            6406682,
            9166567,
            1888182,
            45222728
        ]
                ,
                ((double[])
                [
            18.20391,
            17.739048,
            18.206974,
            19.016758
        ]
                ).ToFloat()
            ),
            (
            [
            9678051,
            21585592,
            21363866,
            10781275,
            43846233,
            25088615,
            574715,
            21490775,
            33578311,
            35766078
        ]
                ,
                ((double[])
                [
            561.5236,
            56.112484,
            466.88828,
            445.31808,
            53.79334,
            537.9285,
            437.16376,
            56.146572,
            561.56537,
            506.6362
        ]
                ).ToFloat()
            ),
            (
            [
            26567421,
            36460337,
            18448947,
            4718276,
            24679374,
            41574474,
            27624409,
            25267522,
            19752903
        ]
                ,
                ((double[])
                [
            2.5684144,
            386.05933,
            0.20666082,
            6.695856,
            2.1886625,
            445.84372,
            350.1298,
            898.43445,
            14.814314
        ]
                ).ToFloat()
            ),
            (
            [
            22493479,
            12957067
        ]
                ,
                ((double[])
[
            561.4873,
            433.8639
        ]
                ).ToFloat()
            ),
            (
            [
            13722499,
            29846840,
            16512517,
            25912415,
            43364222,
            13736384,
            913802,
            41283364,
            17905497,
            6212413,
            31917855,
            32297148,
            18102180
        ]
                ,
                ((double[])
                 [
            82.09288,
            78.69266,
            82.17931,
            214.79503,
            78.708115,
            76.65144,
            82.1715,
            82.14245,
            82.14345,
            82.10149,
            78.68825,
            82.133934,
            78.71051
        ]
                ).ToFloat()
            ),
            (
            [
            43381245,
            43622226,
            45831281,
            45577947,
            6878488,
            6840360,
            20827803,
            20943426,
            6511482,
            6547759,
            106,
            8389040,
            8342626,
            710697,
            706726,
            35898352,
            36097572,
            7706137,
            7749030,
            7388291,
            7429463,
            15992739,
            15904557,
            2646703,
            2632014,
            44533136,
            44287007,
            40765068,
            40539880,
            22844449,
            22718362,
            13647449,
            13723147,
            11415380,
            11478730,
            33228491,
            33412871,
            23131755,
            23260139,
            24631742,
            24495784,
            21820092,
            21699600,
            14282440,
            14361636,
            24415345,
            24550864,
            43386800,
            43627822,
            41442196,
            41213221,
            3128819,
            3146332,
            41123299,
            41351755,
            44369884,
            44616504,
            788316,
            792718,
            28262967,
            28419883,
            41477469,
            41707885,
            20313577,
            20426306,
            48592916,
            48324384,
            28969190,
            29129937,
            8343358,
            8389775,
            9541239,
            9594251,
            45068618,
            45319147,
            37615695,
            37824644,
            41111389,
            40884253,
            9906219,
            9961316,
            7345860,
            7386798
        ]
                ,
                ((double[])
                [
            6.5449333,
            6.5449333,
            447.88486,
            447.88486,
            501.62744,
            501.62744,
            440.5937,
            440.5937,
            2.332525,
            2.332525,
            2.1045618,
            2.1045618,
            2.2008588,
            2.2008588,
            2.8078904,
            2.8078904,
            443.36948,
            443.36948,
            562.9704,
            562.9704,
            2.2951648,
            2.2951648,
            562.6856,
            562.6856,
            495.31128,
            495.31128,
            525.36304,
            525.36304,
            2.332218,
            2.332218,
            470.17755,
            470.17755,
            562.2075,
            562.2075,
            500.90735,
            500.90735,
            487.05273,
            487.05273,
            390.92175,
            390.92175,
            484.4343,
            484.4343,
            2.2337947,
            2.2337947,
            514.67017,
            514.67017,
            538.7692,
            538.7692,
            453.2079,
            453.2079,
            426.62872,
            426.62872,
            562.59296,
            562.59296,
            507.42822,
            507.42822,
            424.85297,
            424.85297,
            562.4949,
            562.4949,
            501.30026,
            501.30026,
            3.1039913,
            3.1039913,
            435.64157,
            435.64157,
            500.63623,
            500.63623,
            3.2154562,
            3.2154562,
            8.880696,
            8.880696,
            442.23334,
            442.23334,
            487.3195,
            487.3195,
            431.6121,
            431.6121,
            431.84338,
            431.84338,
            475.4123,
            475.4123,
            524.1133,
            524.1133
        ]
                ).ToFloat()
            ),
            (
            [
            22694089,
            26771907,
            15007772,
            32505821,
            42664585
        ]
                ,
                ((double[])
                [
            0.3362417,
            0.32207754,
            0.33633602,
            3.0859933,
            2.6622264
        ]
                ).ToFloat()
            ),
            (
            [
            1831189,
            1841375,
            41280824,
            41510171,
            29575007,
            21188231,
            21305840,
            26878256,
            26729930,
            26287622,
            16522838,
            16431756,
            21329562,
            21447971,
            12006385,
            12073035,
            2235316,
            2247701,
            25004859,
            22721490,
            22596080,
            38490867,
            16692180,
            22694897,
            18284029,
            18385483,
            7347367,
            37462547,
            46819624,
            46560898,
            4307907,
            33985706,
            33798139,
            2066720,
            2055299,
            16404242,
            48547655,
            48279384,
            285906,
            40440292,
            40216851,
            11899526,
            11833816,
            18245741,
            18145051,
            1766246,
            31799210,
            31975730,
            3786219,
            38658771,
            38873668,
            40802735,
            25231711,
            25371806,
            29839997,
            29675251,
            48676022,
            48407037,
            7924075,
            7968186,
            47735474,
            48000704,
            29857583,
            29692739,
            25403994,
            25263701,
            28546891,
            28389284,
            39138760,
            38922397,
            18208356,
            36717203,
            36514484,
            42148498,
            42364368,
            42130292,
            30344533,
            30513030,
            45035574,
            24614226,
            24478377,
            28949337,
            39121361,
            39338816,
            11106286,
            11044938,
            40559675,
            40335614,
            12495973,
            12565309,
            42858461,
            43096592,
            42798385,
            43036192,
            35129300,
            34935465,
            37026554,
            35324041,
            35129123,
            28367426,
            46750100,
            39443317,
            39662559,
            31989254,
            32166819,
            4826277,
            45453587,
            45569732,
            45317839,
            16557341,
            44903505
        ]
                ,
                ((double[])
                [
            516.91736,
            516.91736,
            506.5761,
            506.5761,
            554.46014,
            144.37334,
            144.37334,
            458.1635,
            458.1635,
            554.28503,
            282.54962,
            282.54962,
            282.53513,
            282.53513,
            270.22705,
            270.22705,
            530.4294,
            530.4294,
            554.90045,
            156.77849,
            156.77849,
            554.5609,
            554.0945,
            554.1573,
            334.8882,
            334.8882,
            554.04517,
            554.1803,
            79.63519,
            79.63519,
            553.833,
            143.10103,
            143.10103,
            270.10876,
            270.10876,
            553.09937,
            90.977486,
            90.977486,
            553.2748,
            146.91289,
            146.91289,
            294.876,
            294.876,
            516.1331,
            516.1331,
            553.7358,
            257.15704,
            257.15704,
            553.4523,
            271.12717,
            271.12717,
            549.9532,
            190.95735,
            190.95735,
            553.5812,
            553.5812,
            282.41284,
            282.41284,
            310.90494,
            310.90494,
            268.58508,
            268.58508,
            50.53496,
            50.53496,
            257.1442,
            257.1442,
            507.31546,
            507.31546,
            334.8739,
            334.8739,
            554.60956,
            90.977486,
            90.977486,
            553.8074,
            517.8625,
            517.8625,
            270.23593,
            270.23593,
            554.11676,
            79.682594,
            79.682594,
            553.77563,
            119.328865,
            119.328865,
            296.03723,
            296.03723,
            411.2196,
            411.2196,
            295.11774,
            295.11774,
            503.72156,
            503.72156,
            498.94098,
            498.94098,
            214.02063,
            214.02063,
            554.5663,
            51.86529,
            51.86529,
            554.4331,
            553.9235,
            529.5982,
            529.5982,
            493.01593,
            493.01593,
            553.7358,
            553.03735,
            121.12274,
            121.12274,
            554.3993,
            554.00464
        ]
                ).ToFloat()
            )

            //( // Template

            //    ,
            //    ((double[])

            //    ).ToFloat()
            //),
        };

        List<UpsertPointsRequest.UpsertPoint> upsertPoints = new(pointsToUpsert.Capacity);

        int pointId = 0;

        foreach (var point in pointsToUpsert)
        {
            var upsertPoint = new UpsertPointsRequest.UpsertPoint(
                    id: pointId++,
                    vector: new NamedVectors()
                    {
                        Vectors = new Dictionary<string, VectorBase>()
                        {
                            [VectorBase.DefaultVectorName] = point,
                        }
                    },
                    // We deliberately assign large payload
                    payload: """
                    {
                        "type": [
                            "choice",
                            "affiliate_hot"
                        ],
                        "version": "20260202",
                        "camp_ids": [
                            2760,
                            2742,
                            2754
                        ],
                        "segment_ids": [
                            "24386",
                            "23991",
                            "15633",
                            "24573"
                        ],
                        "ship_to_list": [
                            "AZ",
                            "KG",
                            "RU",
                            "BY",
                            "UZ",
                            "MD",
                            "KZ",
                            "TJ",
                            "GE",
                            "AM",
                            "TM"
                        ],
                        "brand_value_id": -1,
                        "local_cate_ids": [
                            16008,
                            12,
                            50,
                            911
                        ],
                        "seller_admin_seq": 6002445992,
                        "source_id_item_id": "0_1005010328150973",
                        "mean_sku_item_price_rub": 121.46
                    }
                    """
                );

            var upsertPointsResult
               = await _qdrantHttpClient.UpsertPoints(
                   TestCollectionName,
                   new UpsertPointsRequest()
                   {
                       Points = [upsertPoint]
                   },
                   CancellationToken.None);

            upsertPointsResult.Status.IsSuccess.Should().BeTrue();

            //upsertPoints.Add(upsertPoint);
        }

        //var upsertPointsResult
        //   = await _qdrantHttpClient.UpsertPoints(
        //       TestCollectionName,
        //       new UpsertPointsRequest()
        //       {
        //           Points = upsertPoints
        //       },
        //       CancellationToken.None);

        //upsertPointsResult.Status.IsSuccess.Should().BeTrue();
    }

    //[Test]

    public async Task Insert_PotentialDuplicates()
    {
        double[] vectorValues =
        [
            0.8787277, -0.12667769, -0.7186715, 0.34238216, 0.6529496, 0.9607358, -1.3407203, -0.05516983, -1.7969699, -0.7624036,
            0.65227294, 1.7223959, 0.09729745, -2.4250467, -0.08025115, 0.5078333, 0.54697776, -0.033634894, 0.15833203,
            0.21261647, -0.32772928, -1.6786869, 1.8116331, -1.1187942, -0.18101482, 0.8181769, 0.9910732, -0.9036228, 0.52683735,
            0.60595685, 0.26787117, 0.92041886, 0.07284273, 0.2019225, 0.03758349, 0.42735377, -1.1501304, -0.33530962,
            -0.39584225, 0.3444461, 0.30743706, 0.20174314, -0.6723415, -0.81343776, 0.22216296, 0.9629104, 0.49917975, 0.1253293,
            1.7895324, -0.5767184, -0.24828121, -0.37844908, 0.5543383, -0.28737727, -0.77188087, 0.8510002, 0.012442401,
            1.5333815, -0.1764392, 0.53742635, 1.0552515, 0.6427478, -1.2882686, 0.5319315, -0.34650293, 0.49427897, -1.4467622,
            -0.5469479, 0.57641643, -0.2019957, -0.04420572, 1.1196884, -2.2209835, 1.6788898, 2.0373118, -1.0778058,
            -0.009934462, -0.4139702, -0.69643164, 0.25623098, 0.32013777, -1.4178662, 1.453767, -1.2854156, -0.4249559,
            -0.30052775, 0.17239584, -0.50819284, -0.16630816, 1.0546737, 0.61845076, 0.24718234, 2.4906254, -0.015319358,
            -0.9086923, 0.4294072, -0.99935985, -0.76197976, 0.7935137, -0.6133997, -0.22259578, 0.86507255, -0.09916944,
            0.37028685, 0.80937463, -0.6712452, 1.1897688, 0.49789405, -0.33125377, 0.55039316, -1.354061, 0.8627084, -0.9022874,
            -0.93917066, -0.16807975, -1.1731709, -0.7422827, -0.06411026, 0.55880874, -0.26387215, 0.36252126, 0.5204782,
            0.7125336, 0.27464563, 1.1216135, 1.2514266, 0.13544944, -1.5647521, 0.18598576, -1.2527033, 0.99144787, 0.34679794,
            -0.2697392, 1.0366445, 1.3917675, -1.2708815, 0.024458002, 1.8469185, -0.689326, -0.033687282, -0.80873257,
            -0.71935505, -0.6340056, 1.0534958, 0.72728986, -0.5091157, 1.1847786, 0.2579973, -0.7781229, 1.1513027, -0.3197454,
            -0.09275967, -1.517871, 0.6641441, 0.9902656, -0.6616016, -0.11708812, 0.3848811, -0.7450218, -0.15346283,
            -0.12680641, 0.84451014, -0.22541003, 0.5130689, 1.5078639, -0.6375235, -0.84930354, -0.08352368, 0.7430522,
            0.7071425, 0.8862804, 0.17265064, -0.4824108, -0.28339827, 0.8509444, -0.17535354, -0.72051644, 0.76037323,
            -1.1822718, -0.7893503, 0.21765956, -1.7401054, 0.4807144, -0.31567746, -0.59089583, -0.31763244, -0.94468486,
            0.94246274, -0.39586225, 0.89199513, 0.594007, 0.9916114, -0.53250146, 1.0358723, -0.24703725, 0.084327, 0.3515454,
            -1.5411878, -0.72129846, -0.5929884, 0.12395483, -0.12162623, 0.5648287, 0.48899993, 1.7190678, 0.48719347,
            0.39768988, -1.4440762, -0.1956659, -0.16685535, 0.79280394, 0.59123456, 0.05968815, -0.5370751, 0.3405953,
            0.037846852, -0.54680467, -1.0382084, 0.10517099, 0.059624612, 0.2955938, -0.6123637, -0.98756886, 0.9852787,
            0.1581021, 0.9339213, 0.49789104, -0.4312542, -0.031734288, 0.30151346, 0.03686244, -1.1644927, -0.82578963,
            -0.06669572, -0.1854245, 0.8741835, 0.494995, 0.7991263, 0.24562435, -0.07677714, -0.6491161, -0.56996995, -1.2649933,
            -1.4961032, -0.4751646, 1.732204, -0.555802, -0.23781323, -1.1293327, 1.320839, 0.09036978, -0.94374526, 1.322917,
            -1.3895092, 0.19756766, -0.13919646, 0.47781587, -0.20061557, 0.67796314, -0.31007573, 0.43472952, -1.0065655,
            0.5434207, -0.046010192, -0.25432864, -0.6564347, -0.006997475, 0.31825593, -0.041912682, 0.6208696, -0.48142615,
            0.5215936, 0.75489926, 0.47194797, -1.1523833, -0.5080032, 0.866584, -0.6534219, 0.3504536, 1.0557897, 0.26673266,
            -0.01611403, -0.9472906, 0.22016095, 1.1266252, 0.412308, -0.35885072, 1.0847564, -0.28795362, -0.81483984,
            -0.08677676, -0.46779558, 0.24048287, 1.7833129, 0.070527196, -0.67235833, 0.24987414, 1.7617239, -0.64356244,
            -0.97504437, -0.24353482, 0.12571855, 1.3705792, -0.73937654, 1.1452163, -0.152253, -0.8273829, 0.90302277, 1.1564949,
            0.7504338, 0.3096949, -1.0588862, -0.4860868, 0.24086839, 0.050243527, -0.4784744, 1.0043734, 0.37202817, 0.4627104,
            -0.103317946, -0.122625, 0.25616556, 0.41967472, -0.19348906, 0.19735594, -0.15588602, 0.047392175, 0.25112972,
            2.953613, -0.29593137, -0.5552204, 0.5595832, -1.3755706E-4, 0.12248584, 0.14107664, 0.9309887, 0.18906182,
            0.31736723, 0.28343913, -0.80899143, -0.64428014, 0.79907346, 0.41659647, 0.84765303, 0.20792724, 0.61453986,
            -0.61848086, 2.055193, -1.0874099, -0.5214486, 1.0196381, 0.013860736, 1.2782339, -0.023881333, -0.02746086,
            -0.06130017, 0.8312153, -1.3321444, 1.2861744, 1.2306224, 0.4554941, -0.20363781, -0.8932166, -0.17654727, 1.1325674,
            -0.0062872786, -0.22994441, 0.37878484, -0.46191177, -0.2876548, -0.4517125, 1.1765171, -0.43365413, -0.12537464,
            1.5034276, -0.40545377, 0.9174505, -1.1173459, -1.6503786, -0.10015173, -0.90019226, -0.68255574, -0.18115757,
            0.7231627, -0.21559593, -1.8912551, -0.71634316, -0.4794962, 0.5201837, 0.47890627, -1.2738028, 0.7875262, -0.7323423,
            0.5981152, -1.5194628, -0.68206453, 0.55715734, -0.71382266, -0.25260982, -1.3942575, -0.062177967, 0.2570095,
            -1.1972195, 0.8392429, 0.32122442, -1.4879935, -0.074141435, -0.51811934, 0.6083805, -0.4347049, -0.28747907,
            -0.53847784, 0.34835902, 0.35684016, -1.9651749, -0.30336195, 0.33380833, 0.8355069, 0.69799054, -0.81458056,
            -1.08207E-4, -0.88231516, 0.42223445, -0.22387332, -0.25584438, -1.2549261, 0.19197018, 1.0597714, -0.05390944,
            -0.8712299, 0.11868691, -0.39711228, -0.42881098, -0.36508253, -0.2043958, 1.1044091, -0.4887433, 0.98630166,
            -0.27948484, -1.3371253, 1.0713089, 0.8232338, -1.5204235, -0.14225918, 0.0061889407, 0.80432254, -1.060877,
            -2.3563209, 0.45460993, -0.78842765, 1.8508009, 1.1128857, -0.90657085, -1.6021861, -0.018929005, -0.05374071,
            0.7287444, -0.27699175, 0.4336507, -0.55254626, -0.5399616, 1.050981, 0.8805241, -0.5352121, -0.8254075, 0.73965216,
            -0.36950216, 0.27920407, 0.975007, 0.70045465, -0.75595695, -0.20699213, -0.01561932, 0.17289829, 1.8555359, 0.987874,
            -0.24096327, -0.65981513, 3.2516613, -0.5791811, 0.4024555, -2.0862217, -0.05749172, -1.076627, -0.25568238,
            -1.0165868, 0.1722168, -1.5710533, 0.5874765, -0.87118876, -0.69088703, 0.22106896, -0.5536876, -1.1332498,
            -0.7522742, 0.9495158, 0.8730732, 0.49048796, 1.0684347, 0.72184396, 0.13845037, -1.5253767, -0.18179461, -0.1182861,
            0.49265796, 0.108968474, 1.1427176, 1.019475, 0.07403621, -0.4736319, -0.1721225, -0.6582855, 0.08298, 0.12150421,
            -1.1602398, 0.069540955, 0.4169343, 1.1188469, -0.6559852, -1.9269425, -0.9092291, 0.09539858, 0.33531758, 0.14254138,
            -0.06950257, -0.6670472, 0.11221711, -0.61708814, 0.14753844, -0.36115593, -0.47757024, 0.24025008, 0.48828104,
            0.5329228, -1.3107795, -0.9958538, -0.29743877, -0.23368645, 0.38540167, -1.7322296, 0.28053617, -0.20590323,
            -0.94827336, -1.0346721, -2.2133863, 0.2952047, -0.40132624, -0.73111236, 0.8975786, -0.30890113, 0.41210577,
            0.61022145, -0.69348776, 0.0472737, -0.6242427, 1.2014728, -0.045957994, 0.3784231, 0.4986334, 1.3898466, 0.09845215,
            1.0892072, 1.0990702, -0.33229685, -0.82345635, 0.62852186, 0.114481926, -0.3608969, 0.6493167, -0.4552299,
            0.12743402, 0.88344306, -1.3145031, -0.66918176, -1.2367066, 0.108011596
        ];

        var vector = vectorValues.Select(v => (float)v).ToArray();

        var payload = new
        {
            cate_local_lv6_id = 7788,
            source_id_item_id = "0_1005007053586082"
        };

        (await _qdrantHttpClient.CreateCollection(
            TestCollectionName,
            new CreateCollectionRequest(VectorDistanceMetric.Cosine, vectorSize: 576, isServeVectorsFromDisk: true),
            CancellationToken.None)).EnsureSuccess();

        (await _qdrantHttpClient.UpsertPoints(
            TestCollectionName,
            new UpsertPointsRequest()
            {
                Points =
                [
                    new UpsertPointsRequest.UpsertPoint(PointId.NewGuid(), vector, payload)
                ]
            },
            CancellationToken.None)).EnsureSuccess();

        await _qdrantHttpClient.EnsureCollectionReady(TestCollectionName, CancellationToken.None);

        var collectionInfo = (await _qdrantHttpClient.GetCollectionInfo(
            TestCollectionName,
            isCountExactPointsNumber: true,
            CancellationToken.None)).EnsureSuccess();

        collectionInfo.PointsCount.Should().Be(1);

        var pointsReadBack = (await _qdrantHttpClient.SearchPoints(
            TestCollectionName,
            new SearchPointsRequest(vector, limit: 10, withVector: true, withPayload: true),
            CancellationToken.None)).EnsureSuccess();

        pointsReadBack.Length.Should().Be(1);
    }

    //[Test]
    public async Task Search()
    {
        double[] vectorRaw =
        [
            0.06732, -0.053447, 0.018991, 0.091428, 0.065955, -0.083695, -0.001819, -0.025018, -0.034342, 0.064136, -0.060952,
            -0.036844, -0.045032, 0.083695, -0.097796, -0.037754, 0.097341, -0.060042, -0.075507, 0.038891, -0.02479, -0.064136,
            0.090973, -0.016375, 0.008358, 0.093702, 0.080966, -0.04958, -0.083695, 0.094157, 0.015124, -0.043667, -0.006283,
            -0.069594, 0.094157, 0.039118, -0.039346, 0.000174, 0.06732, 0.025472, -0.022061, -0.068685, 0.075507, -0.00021,
            0.015807, -0.023994, 0.008415, -0.002004, 0.045259, -0.030931, -0.004236, 0.035934, -0.030248, -0.096886, -0.026041,
            -0.059132, -0.072778, -0.019218, 0.004094, -0.069594, -0.030476, 0.08415, 0.020014, -0.028315, -0.081876, 0.021833,
            -0.085969, -0.036162, 0.047761, 0.06732, -0.049808, -0.069139, 0.054584, 0.031158, -0.019559, 0.095067, -0.094157,
            -0.021265, 0.029566, 0.060497, -0.0655, -0.009893, -0.008472, -0.015579, 0.075053, 0.002303, 0.010064, -0.061407,
            0.095976, 0.037526, 0.024904, -0.080511, 0.02081, 0.06823, -0.071869, -0.070504, 0.056631, 0.00361, 0.00064, -0.039801
        ];

        var vector = vectorRaw.Select(v => (float)v).ToArray();

        var searchResult = await _qdrantHttpClient.SearchPoints(
            "test_collection_dim_100",
            new SearchPointsRequest(vector, 1)
            {
                WithVector = true,
                WithPayload = true,
            }
            ,
            CancellationToken.None);

        searchResult.Status.IsSuccess.Should().BeTrue();
    }
}
#pragma warning restore IDE0059 // Unnecessary assignment of a value
